<!DOCTYPE html>
<html lang="ko">


<head>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NHD74QDQ');</script>
    <!-- End Google Tag Manager -->


    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    <title>페북 Graph API 자주 끊기는 시대, ASP.NET Core 로그인은 이렇게 관리해야 한다 | 포프머신</title>
    
    
    
    <link rel="stylesheet" href="/ko/assets/lib/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/ko/assets/css/site.css?1762029392655704193" />
    <link rel="stylesheet" href="/ko/assets/css/prism-pocu.min.css" />

    <link rel="shortcut icon" href="/ko/assets/favicon.ico" />

    <link rel="canonical" href="https://blog.popekim.com/ko/2025/08/31/aspnet-core-facebook-login-graph-api-management.html" />

<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed.xml" title="포프머신 | 모든글" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/dev.xml" title="포프머신 | 개발" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/music.xml" title="포프머신 | 음악" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/personal.xml" title="포프머신 | 개인" />

    <link rel="alternate" href="https://blog.popekim.com/ko/2025/08/31/aspnet-core-facebook-login-graph-api-management.html" hreflang="ko" />
    <link rel="alternate" href="https://blog.popekim.com/en/2025/08/31/aspnet-core-facebook-login-graph-api-management.html" hreflang="en" />

    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous"></script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1575918182992085" crossorigin="anonymous"></script>
    

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&subset=korean&display=block" rel="stylesheet">
</head>

<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NHD74QDQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    
<nav class="navbar navbar-expand-lg fixed-top navbar-light shadow-sm px-3 px-sm-0 py-lg-3 bg-white">
    <div class="container">
        <a class="navbar-brand" href="/ko/">
            <img class="mt-2 mb-2" src="/ko/assets/img/navbar_logo.png" />
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
<ul class="navbar-nav ml-auto mr-lg-3">
    <li class="nav-item">
        <a class="nav-link font-weight-bold" href="/ko/about.html">소개</a>
    </li>
    <li class="nav-item">
        <a class="nav-link font-weight-bold " href="/ko/books.html">저서목록</a>
    </li>
    <li class="nav-item">
        <a class="nav-link font-weight-bold" href="/ko/archives/">모든글</a>
    </li>
    
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/dev">cat:개발</a>
        </li>
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/music">cat:음악</a>
        </li>
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/personal">cat:개인</a>
        </li>
    
</ul>

        </div>
    </div>
</nav>

    <div class="container doc">
        <div class="pt-4 pb-4">
    <div class="row no-gutters">
        <div class="col-lg-10 offset-lg-1">
            <article class="shadow--md px-md-5 py-md-5 border--md rounded">
                <header>
                    <h1 class="card-title text-center mb-4 font-weight-bold">페북 Graph API 자주 끊기는 시대, ASP.NET Core 로그인은 이렇게 관리해야 한다</h1>
                    <div class="h6 text-muted text-center mb-4 mb-md-5"><img width="70" src="/ko/assets/img/authors/pope.gif" class="rounded-circle mx-auto d-block mb-3" />
                        <span
                            class="h6 border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-3 align-middle">
                            김포프</span>
                        

                        <span class="h6 text-muted align-middle pl-1 pl-lg-2">
                            <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                            2025-08-31
                        </span><ul class="list-inline list-unstyled mt-2">
                            <li class="list-inline-item align-middle opacity-75"><small><i
                                        class="fas fa-tags"></i></small></li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/dev/">개발</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/best-practice/">베스트프랙티스</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/web/">웹</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/csharp/">C#</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/defensive-programming/">방어적프로그래밍</a></small>
                            </li></ul></div>
                </header>
                <section class="pt-4 pb-4 pb-md-5 border border-top-0 border-right-0 border-left-0">
                    <p>ASP.NET Core에서 페북 로그인 붙이는 건 원래 진짜 쉽다. NuGet에서 <code>Microsoft.AspNetCore.Authentication.Facebook</code> 패키지 하나 설치하고 <code>services.AddFacebook()</code>만 해주면 끝이다. AppId랑 Secret 넣어주면 바로 로그인 화면 뜨고, 토큰까지 잘 들어온다.</p>

<p>근데 이걸 그대로 믿고 쓰다가는 어느 날 갑자기 서비스가 멈춘다. 나도 실제로 몇 년 전에 크게 당했다. 이유는 단순했다. <strong>NuGet 패키지 기본값이 바라보는 Facebook Graph API 버전이 너무 구식</strong>이었던 거다. 당시엔 v11을 쓰고 있었는데, 이게 페북에서 지원 종료되자 로그인 기능이 바로 깨져버렸다.</p>

<h2 id="왜-이렇게-신경을-쓰는가">왜 이렇게 신경을 쓰는가</h2>

<p>우리 <a href="https://pocu.academy">POCU 아카데미</a>는 <strong>소셜 로그인에만 의존</strong>한다. 우리 쪽에서 패스워드나 주민번호 같은 불필요한 고객 정보를 아예 저장하지 않는다. "패스워드 저장"이란 건 생각보다 굉장히 위험한 짓이다. 아무리 잘 암호화하고 잘 보관한다고 해도 유출 위험은 늘 존재한다. 실제로 보안 사고 뉴스를 보면 대부분은 "우리 서비스 DB가 털렸다 → 유저 비밀번호가 유출됐다" 패턴이니까.</p>

<p>우리는 그냥 <strong>인증은 전부 페북, 구글, 네이버 같은 외부 서비스</strong>에 맡기고, 거기서 인증된 결과만 받아온다. 우리 쪽은 사실상 "저 사람은 진짜 그 계정이 맞다"는 보증서만 받는 셈이다.</p>

<p>구체적으로 말하면, 페북 로그인 성공 후에 우리한테 떨어지는 건 대략 이런 값들이다.</p>

<ul>
  <li><strong>Provider key</strong>: 페북이 발급해주는 유저 고유 키</li>
  <li><strong>Access token</strong>: 페북 Graph API에 접근할 수 있는 토큰</li>
  <li>(옵션) <strong>이메일, 이름</strong> 같은 기본 공개 정보</li>
</ul>

<p>이 정도만 있으면 우리 서비스에서는 "아, 이 사람이 진짜 동일인"이라는 걸 확인할 수 있다. 우리 입장에선 훨씬 안전하다. "유저의 민감한 비밀번호"는 건드릴 필요도 없고, 책임도 외부 서비스가 대신 져준다.</p>

<h2 id="잠깐-oauth는-어떻게-동작할까">잠깐, OAuth는 어떻게 동작할까?</h2>

<p>사실 페북 로그인은 내부적으로 <strong>OAuth 2.0 프로토콜</strong>을 쓴다. 복잡하게 보면 끝도 없지만 아주 간단히 줄이면 이렇다.</p>

<ol>
  <li>사용자가 "페북으로 로그인" 버튼을 누른다.</li>
  <li>우리 서비스는 사용자를 페북 로그인 페이지로 리디렉트한다.</li>
  <li>사용자가 페북 계정/비밀번호로 로그인하고 동의 버튼을 누른다.</li>
  <li>페북이 우리 서비스로 <strong>Authorization Code</strong>를 준다.</li>
  <li>우리 서비스는 이 코드를 다시 페북에 보내서 <strong>Access Token</strong>을 받아온다.</li>
  <li>그 토큰으로 <code>/me</code> API를 호출해서 유저 정보를 가져온다.</li>
</ol>

<p>여기서 핵심은 우리 서비스가 <strong>직접 사용자 비밀번호를 알 필요가 전혀 없다는 것</strong>이다. 전부 페북이 인증해주고, 우리는 "페북이 보증한 토큰"만 신뢰하면 된다.</p>

<h2 id="문제의-nuget-패키지">문제의 NuGet 패키지</h2>

<p>그런데 문제는 이 과정에서 쓰이는 페북 Graph API 버전이 항상 최신은 아니라는 거다. 마소 쪽 <code>Microsoft.AspNetCore.Authentication.Facebook</code> 패키지는 기본적으로 내부 엔드포인트를 하드코딩해둔다. 예를 들어 예전에는 v11을 기본으로 쓰고 있었고, 이게 EOL되면서 서비스가 한순간에 깨져버렸다.</p>

<p>그래서 나는 그냥 이렇게 코드에서 직접 오버라이드한다.</p>

<pre><code class="language-csharp">services.AddAuthentication()
    .AddFacebook(facebookOptions =&gt;
    {
        facebookOptions.AuthorizationEndpoint = Constants.AUTHORIZATION_ENDPOINT;
        facebookOptions.UserInformationEndpoint = Constants.USER_INFORMATION_ENDPOINT;
        facebookOptions.TokenEndpoint = Constants.TOKEN_ENDPOINT;

        facebookOptions.AppId = config["Authentication:Facebook:AppId"];
        facebookOptions.AppSecret = config["Authentication:Facebook:AppSecret"];
        facebookOptions.AccessDeniedPath = accountAccessDeniedPath;
        facebookOptions.Events.OnRemoteFailure = handleOnRemoteFailureAsync;
    });
</code></pre>

<p>그리고 상수는 이렇게:</p>

<pre><code class="language-csharp">public static class Constants
{
    public const string AUTHORIZATION_ENDPOINT = "https://www.facebook.com/v17.0/dialog/oauth";

    public const string USER_INFORMATION_ENDPOINT = "https://graph.facebook.com/v17.0/me";

    public const string TOKEN_ENDPOINT = "https://graph.facebook.com/v17.0/oauth/access_token";
}
</code></pre>

<h2 id="왜-안-빼고-유지하냐">왜 안 빼고 유지하냐?</h2>

<p>사실 언제든 저 상수랑 오버라이드 코드를 빼고 싶었다. NuGet 패키지가 제때 최신 버전을 반영해주면 굳이 내가 관리할 필요가 없으니까. 그런데 현실은… <strong>v17이 곧 만료되는 지금까지도 정식 NuGet 패키지에는 반영이 안 돼 있다.</strong> preview 브랜치에는 이미 새로운 버전이 들어가 있는데도 정식 릴리스는 여전히 구버전을 쓰고 있다는 거다.</p>

<p>그러니 신뢰가 안 간다. 이쯤 되면 그냥 내가 직접 관리하는 게 속 편하다. 다행히 페북은 API 만료 전에 미리 이메일을 보내준다. 그때 알림을 받으면 코드에서 버전 문자열만 올려주고 테스트 돌리면 끝이다. 사실상 "내 손으로 버전 관리하는 구조"지만, 그래도 서비스가 한밤중에 갑자기 터지는 일은 피할 수 있다.</p>

<h2 id="결론">결론</h2>
<p>페북은 너무 자주 구버전을 끊고, 마소 NuGet 패키지는 업데이트 속도가 그걸 못 따라간다. 그 사이에서 삽질하고 욕 먹는 건 결국 개발자다. 그래서 난 그냥 지금처럼 엔드포인트를 직접 오버라이드하고, 버전을 내가 관리하는 방식으로 계속 갈 거다.</p>

<p><strong>교훈: ASP.NET Core에서 페북 로그인? 기본값 믿지 마라. 버전은 내가 직접 잡고 간다.</strong></p>

                    
                    
                    
                    <section class="pt-5 pb-3 text-center welcome-to-pocu">
                        <a href="https://pocu.academy/ko/Courses/COMP2200" class="d-inline-block border text-decoration-none text-left rounded to-pocu" id="a001">
                            <div class="d-flex flex-row align-content-center">
                                <div class="d-none d-md-block border border-top-0 border-bottom-0 border-left-0">
                                    <img src="https://blog.pocu.academy/ko/assets/img/logos/COMP2200.png" alt="img" />
                                </div>
                                <div class="d-flex flex-column justify-content-center px-4 py-3">
                                    <h2 class="headlines font-weight-bold">
                                        포인터의 확실한 이해 | C 언어 독학 | 모든 프로그래밍 언어의 어머니
                                    </h2>
                                    <p class="description m-0">5차 산업혁명을 책임질 컴퓨터 하드웨어 지식! POCU 아카데미에서 C 언어를 마스터하세요!</p>
                                </div>
                            </div>
                        </a>
                    </section></section>
                
                <footer class="pt-4 pt-md-5">
                    <h2 class="h4">관련 글</h2>
                    <ul class="list-unstyled">
                        
                        <li><a href="/ko/2025/08/17/tempdata-helper.html">재사용은커녕 단 한 번 호출... 그런데도 합당했던 함수</a></li>
                        
                        <li><a href="/ko/2025/10/17/two-db-commit-side-effects.html">두 개의 DB에 동시에 쓰면서 사이드 이펙트를 최소화하는 방법</a></li>
                        
                        <li><a href="/ko/2023/10/01/danger-of-weak-typing.html">약한 자료형의 위험성</a></li>
                        
                    </ul>
                </footer>
                
                <footer>
                    
<script src="https://giscus.app/client.js"
    data-repo="popekim/blog.popekim.com-comments-ko"
    data-repo-id="R_kgDOOND35A"
    data-category="Comments"
    data-category-id="DIC_kwDOOND35M4CoXGy"
    data-mapping="pathname"
    data-strict="1"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="ko"
    crossorigin="anonymous"
    async>
</script>
                </footer>
            </article>
        </div>
    </div>
</div>
    </div>
    
    <footer class="site-footer position-absolute border-top">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-5 pl-sm-0 pl-lg-6">
                <div>
                    <span class="ml-1">Copyright © 2010 - 2025. Pope Kim</span>
                </div>
            </div>
            <div class="col col-md-5 m-0 p-sm-0 text-md-right">
                <a class="mr-sm-3 mr-0 text-secondary text-nowrap font-weight-bold" href="/en">English</a>
                <span class="h5 opacity-75"><a href="/ko/feed.xml" class="badge badge-dark"><i class="fas fa-rss"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.youtube.com/c/PopeTV/" class="badge badge-dark" target="_blank"><i class="fab fa-youtube"></i></a></span>
                <span class="h5 opacity-75"><a href="https://x.com/blindrendererkr" class="badge badge-dark" target="_blank"><i class="fab fa-twitter"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.linkedin.com/in/popekim/" class="badge badge-dark" target="_blank"><i class="fab fa-linkedin-in"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.github.com/popekim/" class="badge badge-dark" target="_blank"><i class="fab fa-github"></i></a></span>
            </div>
        </div>
    </div>
</footer>
    
<script src="/ko/assets/lib/jquery/jquery-3.7.1.slim.min.js"></script>
<script src="/ko/assets/lib/bootstrap/js/bootstrap.bundle.js"></script>
<script src="/ko/assets/lib/prism/js/prism.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-asm6502.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-c.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-cpp.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-csharp.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-java.min.js"></script>
<script src="/ko/assets/js/prism/prism-masm.min.js"></script>
<script src="/ko/assets/js/saveLangToCookie.js" type="text/javascript"></script>

</body>

</html>