<!DOCTYPE html>
<html lang="ko">


<head>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NHD74QDQ');</script>
    <!-- End Google Tag Manager -->


    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    <title>[포프의 쉐이더 입문강좌] 01. 쉐이더란 무엇이죠? Part 2 | 포프머신</title>
    
    
    
    <link rel="stylesheet" href="/ko/assets/lib/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/ko/assets/css/site.css?1762029392655704193" />
    <link rel="stylesheet" href="/ko/assets/css/prism-pocu.min.css" />

    <link rel="shortcut icon" href="/ko/assets/favicon.ico" />

    <link rel="canonical" href="https://blog.popekim.com/ko/2011/12/05/intro-to-shader-01-what-is-shader-part-2.html" />

<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed.xml" title="포프머신 | 모든글" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/dev.xml" title="포프머신 | 개발" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/music.xml" title="포프머신 | 음악" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/personal.xml" title="포프머신 | 개인" />

    

    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous"></script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1575918182992085" crossorigin="anonymous"></script>
    

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&subset=korean&display=block" rel="stylesheet">
</head>

<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NHD74QDQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    
<nav class="navbar navbar-expand-lg fixed-top navbar-light shadow-sm px-3 px-sm-0 py-lg-3 bg-white">
    <div class="container">
        <a class="navbar-brand" href="/ko/">
            <img class="mt-2 mb-2" src="/ko/assets/img/navbar_logo.png" />
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
<ul class="navbar-nav ml-auto mr-lg-3">
    <li class="nav-item">
        <a class="nav-link font-weight-bold" href="/ko/about.html">소개</a>
    </li>
    <li class="nav-item">
        <a class="nav-link font-weight-bold " href="/ko/books.html">저서목록</a>
    </li>
    <li class="nav-item">
        <a class="nav-link font-weight-bold" href="/ko/archives/">모든글</a>
    </li>
    
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/dev">cat:개발</a>
        </li>
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/music">cat:음악</a>
        </li>
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/personal">cat:개인</a>
        </li>
    
</ul>

        </div>
    </div>
</nav>

    <div class="container doc">
        <div class="pt-4 pb-4">
    <div class="row no-gutters">
        <div class="col-lg-10 offset-lg-1">
            <article class="shadow--md px-md-5 py-md-5 border--md rounded">
                <header>
                    <h1 class="card-title text-center mb-4 font-weight-bold">[포프의 쉐이더 입문강좌] 01. 쉐이더란 무엇이죠? Part 2</h1>
                    <div class="h6 text-muted text-center mb-4 mb-md-5"><img width="70" src="/ko/assets/img/authors/pope.gif" class="rounded-circle mx-auto d-block mb-3" />
                        <span
                            class="h6 border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-3 align-middle">
                            김포프</span>
                        

                        <span class="h6 text-muted align-middle pl-1 pl-lg-2">
                            <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                            2011-12-05
                        </span><ul class="list-inline list-unstyled mt-2">
                            <li class="list-inline-item align-middle opacity-75"><small><i
                                        class="fas fa-tags"></i></small></li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/book/">도서</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader-book/">셰이더강좌</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul></div>
                </header>
                <section class="pt-4 pb-4 pb-md-5 border border-top-0 border-right-0 border-left-0">
                    <b><a href="http://kblog.popekim.com/2011/11/01-part-1.html">이전편 보기</a></b><br /><br /><b><a href="https://www.box.com/s/9409f61ba4f1a34254c6" target="_blank">샘플파일 받기</a></b><br /><br /><span class="Apple-style-span" style="font-size: x-large;"><b>쉐이더 프로그래밍</b></span><br />자, 그럼 쉐이더가 무엇인지는 대충 알아보았는데 쉐이더를 코드를 짠다는 것은 무슨 뜻일까요? 일단 그림 1.1을 다시 한번 살펴보죠. 그림 1.1을 보면 사각형으로 표현한 파이프라인 단계도 있고 둥글게 표현한 것도 있죠? 원형으로 표현한 단계들은 GPU(graphics processing unit, 그래픽 처리장치)가 알아서 처리해주는 -- 즉 프로그래머가 따로 제어할 수 없는 -- 단계들입니다. 그와 반대로 사각형으로 표현한 단계들은 프로그래머가 마음대로 제어할 수 있는 단계들이죠. 이 단계에서 사용할 함수를 작성하는 것이 바로 쉐이더 프로그래밍입니다. 그림 1.1에서 사각형으로 표현된 단계들은 정점쉐이더와 픽셀쉐이더 뿐인 거 보이시죠? 따라서 정점쉐이더와 픽셀쉐이더에 사용할 함수를 하나씩 만드는 것이 쉐이더 프로그래밍입니다. <span class="Apple-style-span" style="font-size: x-small;">(DirectX 10과 11에서 새로운 쉐이더들이 추가되었습니다. 하지만 아직 실무에서 널리 사용되지 않아서 실용적인 접근이 어렵고, 입문자에게 적당하지 않은 내용이라 이 책에서 다루지 않습니다.)</span><br /><br />시중에 나와 있는 여러 쉐이더 언어 중에 이 책에서 사용할 언어는 DirectX에서 지원하는 HLSL입니다. HLSL(High Level Shader Language, 고수준 쉐이더언어)은 C와 매우 비슷한 문법을 사용하는 언어로 GLSL<span class="Apple-style-span" style="font-size: x-small;">(OpenGL Shader Language의 약자로 OpenGL에서 지원하는 쉐이더 언어입니다. HLSL과 문법 정도가 조금 다릅니다.)</span>이나 CgFX<span class="Apple-style-span" style="font-size: x-small;">(엔비디아에서 지원하는 쉐이더 언어입니다. HLSL과 한두 개 빼고는 완전히 똑같습니다.)</span>등의 기타 쉐이더 언어와 매우 흡사합니다. 따라서 HLSL을 배우시면 다른 쉐이더 언어를 익히시는데도 큰 무리가 없을 것입니다.<br /><br />한 언어를 배우는 최선의 방법은 직접 코딩을 하면서 배우는 것입니다. 이 언어의 철학은 이러네, 이 언어의 문법은 저러네 하면서 백날 떠들어봐야 입문자들은 하품만 하고 무슨 이야긴지 알아듣지도 못합니다. 일단 재미있게 코드를 짜봐야 프로그래밍에 애착도 생기고, 애착이 생기면 보다 나은 프로그래머가 되기 위해 노력을 하지요. 따라서 이 책에서는 쓸데없이 HLSL 문법을 나열하면서 독자분들의 짜증을 부추기는 대신 무조건 아주 쉬운 쉐이더부터 짜보는 방법으로 HLSL을 배우도록 하겠습니다. 정 문법이 궁금하신 분들은 부록을 참고하시길 바랍니다.<br /><br />하지만 HLSL 코드를 곧바로 짜기 전에 준비해야 할 것들이 좀 있군요. 이건 좀 지루하시더라도 꾹 참고 따라 해주시기 바랍니다.<br /><br /><span class="Apple-style-span" style="font-size: x-large;"><b>쉐이더 프로그래밍을 위한 기본준비</b></span><br />서문에서도 말씀드렸듯이 이 책의 초점은 쉐이더 프로그래밍입니다. 이 책에서 DirectX에 대한 내용을 자세히 다루지 않기로 결정한 이유는 이미 훌륭한 DirectX 입문 책들이 시중에 나와있는데 굳이 DirectX를 다시 처음부터 소개하면서 쓸데없이 지면을 낭비하고 싶지 않았기 때문입니다. <span class="Apple-style-span" style="font-size: x-small;">(<span lang="KO" style="font-family: 바탕, serif;">지면이</span><span lang="KO" style="font-family: 'Times New Roman', serif;"> </span><span lang="KO" style="font-family: 바탕, serif;">늘어나면</span><span lang="KO" style="font-family: 'Times New Roman', serif;"> </span><span lang="KO" style="font-family: 바탕, serif;">쓸데없이</span><span lang="KO" style="font-family: 'Times New Roman', serif;"> </span><span lang="KO" style="font-family: 바탕, serif;">책</span><span lang="KO" style="font-family: 'Times New Roman', serif;"> </span><span lang="KO" style="font-family: 바탕, serif;">값도</span><span lang="KO" style="font-family: 'Times New Roman', serif;"> </span><span lang="KO" style="font-family: 바탕, serif;">오릅니다</span><span style="font-family: 'Times New Roman', serif;">.)</span></span>&nbsp;또한 프로그래머 분들 외에 테크니컬 아티스트 분들도 이 책을 읽으실 수 있도록 하기 위해서입니다.<br /><br />마찬가지 이유로 이 책에서 쉐이더를 만드는 과정도 둘로 나눴습니다. 첫 번째 단계는 쉐이더 작성만을 하는 단계로 AMD(전 ATI) 사의 렌더몽키(render monkey)라는 프로그램을 사용합니다. 이 단계는 프로그래머와 아티스트 분들을 모두 대상으로 하므로 반드시 따라 해 주시기 바랍니다.<br /><br />두 번째 단계는 렌더몽키에서 만든 쉐이더를 C++/DirectX 프레임워크에서 불러와 사용하는 것으로 프로그래머 분들을 위한 단계입니다. 프로그래머이시더라도 C++/DirectX 프레임워크에 관심이 없으신 분들은 이 단계를 건너 뛰셔도 됩니다. 실제로 쉐이더 코드를 작성하는 곳은 첫 번째 단계입니다.<br /><br />자, 그러면 위 두 단계에서 쉐이더를 배우는 데 필요한 것들을 준비해보죠.<br /><br /><span class="Apple-style-span" style="font-size: large;"><b>렌더몽키</b></span><br />렌더몽키는 AMD사에서 제공하는 쉐이더 작성도구로 프로토타이핑에 유용합니다. 부록 디스크에서 <a href="http://developer.amd.com/Downloads/RenderMonkey.2008-12-17-v1.82.322.msi" target="_blank">/RenderMonkey/ RenderMonkey.2008-12-17-v1.82.322.msi</a>를 찾아 설치해 주세요. 그냥 기본(default) 옵션으로 설치하시면 되겠습니다.<br /><br /><b><span class="Apple-style-span" style="font-size: large;">선택사항: 간단한 DirectX 프레임워크</span></b><br />C++/DirectX 프레임워크에서 쉐이더를 실행해보고 싶으신 분들만 이 절을 따라 해주세요.<br /><br />우선 비주얼 C++ 2008과 DirectX SDK를 설치하시기 바랍니다. 비주얼 C++을 소장하고 계시지 않으신 분들은 마이크로소프트사의 웹 페이지에서 공짜 버전인 익스프레스 버전을 다운받으실 수 있습니다. <a href="http://www.microsoft.com/download/en/details.aspx?displaylang=en&amp;id=6812" target="_blank">DirectX SDK는 부록 CD의 DXSDK 폴더에 포함</a>되어 있습니다.<br /><br />위 두 프로그램의 설치를 마치셨다면 비주얼 C++ 2008에서 부록 CD에 있는 samples/01_DxFramework/BasicFramework.sln 파일을 여시기 바랍니다. 별다른 수정 없이 이 프로그램을 실행하면 다음과 같은 파란 화면을 보실 수 있을 것입니다.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="/ko/assets/img/2011/12/12.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="500" src="/ko/assets/img/2011/12/13.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><b>그림 1.2. 별볼일 없는 초 간단 프레임워크</b></td></tr></tbody></table><br /><br />이 프레임워크는 다음과 같은 기능들을 구현합니다.<br /><br /><ul><li>창의 생성 및 메시지 루프 등의 기본적인 윈도우 기능</li><li>Direct 3D 장치 생성</li><li>텍스처, 모델, 쉐이더 등의 자원 로딩</li><li>간단한 게임루프</li><li>간단한 키보드 입력처리</li></ul><br /><br />참고로 말씀드리는데 이 프로그램은 쉐이더 코드를 재빨리 실행할 수 있도록 매우 간단하게 만든 프레임워크입니다. 그 결과, 모든 함수들이 .cpp 파일 하나 안에 들어있고, 클래스나 개체도 사용하지 않지요. 따라서 모든 함수들은 C스타일로 작성되어 있고, 모든 변수들도 전역적으로 선언되어 있습니다. <b>실제 게임을 만드실 때, 이렇게 프레임워크를 만드시면 절대 안됩니다.</b> 다시 한 번 말씀드리는데 이 프레임워크는 쉐이더 데모를 실행할 수 있도록 만든 프로그램일 뿐입니다.<br /><br />자, 그럼 적당히 주의도 드렸으니 이제 프레임워크를 살펴보도록 합시다. 우선 BasicFramework.h를 엽니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//**********************************************************************</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// ShaderFramework.h</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 쉐이더 데모를 위한 C스타일의 초간단 프레임워크입니다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// (실제 게임을 코딩하실 때는 절대 이렇게 프레임워크를</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 작성하시면 안됩니다. -_-)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// Author: Pope Kim</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//**********************************************************************</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#pragma once</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#include &lt;d3d9.h&gt;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#include &lt;d3dx9.h&gt;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// ---------- 선언 ------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#define WIN_WIDTH<span class="Apple-tab-span" style="white-space: pre;">  </span>800</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#define WIN_HEIGHT<span class="Apple-tab-span" style="white-space: pre;">  </span>600</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// ---------------- 함수 프로토타입 ------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 메시지 처리기 관련</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LRESULT WINAPI MsgProc( HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void ProcessInput(HWND hWnd, WPARAM keyPress);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 초기화 과련</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bool InitEverything(HWND hWnd);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bool InitD3D(HWND hWnd);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bool LoadAssets();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPD3DXEFFECT LoadShader( const char * filename );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPDIRECT3DTEXTURE9 LoadTexture(const char * filename);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPD3DXMESH LoadModel(const char * filename);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 게임루프 관련</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void PlayDemo();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void Update();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 렌더링 관련</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void RenderFrame();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void RenderScene();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void RenderInfo();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 뒷정리 관련</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void Cleanup();</span><br /><br /><br />이 헤더파일에서 눈 여겨 볼만한 것은 WIN_WIDTH와 WIN_HEIGHT밖에 없습니다. 이 두 #define문은 데모 프로그램의 창 크기를 정의합니다. 나머지 코드들은 단순히 함수선언들일 뿐입니다. 실제 함수들의 구현은 ShaderFramework.cpp 파일에 들어 있으니 ShaderFramework.cpp 파일을 열어보도록 할까요?<br /><br />이 파일의 제일 위에는 다음과 같은 전역변수들이 정의되어 있습니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//----------------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 전역변수</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//----------------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// D3D 관련</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPDIRECT3D9 &nbsp; &nbsp; &nbsp; gpD3D &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= NULL; &nbsp; &nbsp; &nbsp; &nbsp;// D3D</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPDIRECT3DDEVICE9 gpD3DDevice &nbsp; &nbsp;= NULL; &nbsp; &nbsp; &nbsp; &nbsp;// D3D 장치</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 폰트</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">ID3DXFont* &nbsp; &nbsp; &nbsp; &nbsp;gpFont &nbsp; &nbsp; &nbsp; &nbsp; = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 모델</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 쉐이더</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 텍스처</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 프로그램 이름</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">const char* &nbsp; &nbsp; &nbsp; gAppName<span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp; &nbsp; = "초 간단 쉐이더 데모 프레임워크";</span><br /><br /><br />이제 프로그램의 창을 생성할 차례입니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//-----------------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 프로그램 진입점/메시지 루프</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//-----------------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 진입점</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">INT WINAPI WinMain( HINSTANCE hInst, HINSTANCE, LPSTR, INT )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><br />프로그램의 창을 생성하려면 우선 윈도우 클래스를 등록해야 합니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 윈도우 클래스를 등록한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; WNDCLASSEX wc = { sizeof(WNDCLASSEX), CS_CLASSDC, MsgProc, 0L, 0L,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GetModuleHandle(NULL), NULL, NULL, NULL, NULL,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gAppName, NULL };</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; RegisterClassEx( &amp;wc );</span><br /><br /><br />이제 CreateWindow 함수를 사용해서 위에서 등록한 윈도우 클래스의 인스턴스를 만듭니다. 이 때, 앞서 정의했던 WIN_WIDTH와 WIN_HEIGHT를 창의 크기로 지정합니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 프로그램 창을 생성한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; DWORD style = WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; HWND hWnd = CreateWindow( gAppName, gAppName,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; style, CW_USEDEFAULT, 0, WIN_WIDTH, WIN_HEIGHT,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GetDesktopWindow(), NULL, wc.hInstance, NULL );</span><br /><br />창의 크기를 WIN_WIDTH와 WIN_HEIGHT로 만들면 실제 렌더링을 할 수 있는 공간이 이보다 작습니다. 창의 크기에 타이틀 바 및 경계선이 포함되기 때문이라죠. 따라서 실제 렌더링이 가능한 공간(client rect)이 WIN_WIDTH와 WIN_HEIGHT와 같도록 창의 크기를 재조정해야 겠네요.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // Client Rect 크기가 WIN_WIDTH, WIN_HEIGHT와 같도록 크기를 조정한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; POINT ptDiff;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; RECT rcClient, rcWindow;</span><br /><span class="Apple-tab-span" style="font-family: 'Courier New', Courier, monospace; white-space: pre;"> </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; GetClientRect(hWnd, &amp;rcClient);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; GetWindowRect(hWnd, &amp;rcWindow);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; ptDiff.x = (rcWindow.right - rcWindow.left) - rcClient.right;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; ptDiff.y = (rcWindow.bottom - rcWindow.top) - rcClient.bottom;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; MoveWindow(hWnd,rcWindow.left, rcWindow.top, WIN_WIDTH + ptDiff.x, WIN_HEIGHT + ptDiff.y, TRUE);</span><br /><br />이제 창의 크기도 적절히 조정했으니 창을 보여줄 차례입니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; ShowWindow( hWnd, SW_SHOWDEFAULT );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; UpdateWindow( hWnd );</span><br /><br /><br />다음은 Direct3D를 초기화하고 모든 D3D 자원들(텍스처, 쉐이더, 메쉬 등)을 로딩합니다. 이 모든 기능들은 InitEverything() 함수 안에 포함되어 있습니다. 만약 Direct3D 및 기타 초기화에 실패하면 데모를 보여주는 게 불가능하므로 프로그램을 종료합니다.<br /><span class="Apple-tab-span" style="white-space: pre;"> </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // D3D를 비롯한 모든 것을 초기화한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if( !InitEverything(hWnd) )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; PostQuitMessage(1);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><br />D3D 및 기타 초기화를 마쳤다면 남은 일은 WM_QUIT 메시지를 받을 때까지 데모를 실행하는 것이 전부입니다. WM_QUIT은 데모를 종료하라는 윈도우 메시지입니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 메시지 루프</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; MSG msg;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; ZeroMemory(&amp;msg, sizeof(msg));</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; while(msg.message!=WM_QUIT)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; if( PeekMessage( &amp;msg, NULL, 0U, 0U, PM_REMOVE ) )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TranslateMessage( &amp;msg );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DispatchMessage( &amp;msg );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; else // 메시지가 없으면 게임을 업데이트하고 장면을 그린다</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PlayDemo();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><br />데모를 종료할 때가 되면 윈도우 클래스의 등록을 해제하고 프로그램을 끝마칩니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; UnregisterClass( gAppName, wc.hInstance );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />다음은 윈도우 메시지를 처리하는 함수입니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 메시지 처리기</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LRESULT WINAPI MsgProc( HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; switch( msg )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">키보드 입력은 ProcessInput이라는 함수에서 처리할 것입니다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; case WM_KEYDOWN:</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; ProcessInput(hWnd, wParam);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; break;</span><br /><br /><br />창이 닫힐 때는 초기화 도중에 생성했던 D3D 자원들을 해제하고 프로그램을 종료하라는 메시지를 보냅니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; case WM_DESTROY:</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; Cleanup();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; PostQuitMessage(0);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; return 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><br />이 데모에서 처리하지 않는 윈도우 메시지들은 기본(default) 메시지 처리기가 처리하도록 합니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return DefWindowProc( hWnd, msg, wParam, lParam );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />이 프레임워크가 현재 처리하는 키보드 입력은 ESC 키가 전부입니다. ESC키가 눌리면 프로그램의 실행을 마칩니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 키보드 입력처리</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void ProcessInput( HWND hWnd, WPARAM keyPress)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>switch(keyPress)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>// ESC 키가 눌리면 프로그램을 종료한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>case VK_ESCAPE:</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>PostMessage(hWnd, WM_DESTROY, 0L, 0L);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>break;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><br />이제 초기화 코드를 살펴볼까요?<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 초기화 코드</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bool InitEverything(HWND hWnd)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><br />우선 InitD3D함수를 호출하여 D3D를 초기화합니다. D3D 초기화에 실패하지 않았다면 LoadAssets() 함수를 통해 모델, 쉐이더, 텍스처 등의 D3D 자원들을 로딩합니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // D3D를 초기화</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if( !InitD3D(hWnd) )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; return false;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 모델, 쉐이더, 텍스처 등을 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if( !LoadAssets() )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; return false;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><br />그 다음은 폰트를 로딩할 차례입니다. 이 폰트를 사용하여 화면에 디버그 정보 등을 보여줄 것입니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 폰트를 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if(FAILED(D3DXCreateFont( gpD3DDevice, 20, 10, FW_BOLD, 1, FALSE,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, DEFAULT_QUALITY,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; (DEFAULT_PITCH | FF_DONTCARE), "Arial", &amp;gpFont )))</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>return false;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return true;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><br />위의 D3DXCreateFont()에서 사용했던 각 매개변수의 의미는 순서대로 다음과 같습니다.<br /><br /><ul><li>gpD3DDevice: D3D 장치</li><li>20: 폰트의 높이</li><li>10: 폰트의 너비</li><li>FW_BOLD: 볼드체(두꺼운 폰트)를 이용함</li><li>1: 밉맵레벨</li><li>FALSE: 이탤릭체를 쓰지 않음</li><li>DEFAULT_CHARSET: 기본 문자셋을 사용</li><li>OUT_DEFAULT_PRECIS: 실제 화면에 출력되는 폰트가 여기서 지정한 속성과 어느 정도 비슷해야 하는지를 설정</li><li>DEFAULT_QUALITY: 여기서 지정하는 폰트와 실제 폰트의 품질이 얼마나 비슷해야 하는지 설정</li><li>DEFAULT_PITCH | FF_DONTCARE: 기본 피치를 사용하고 폰트군은 상관 없음</li><li>"Arial": 사용할 폰트이름</li><li>gpFont: 새로 만든 폰트를 저장할 포인터</li></ul><br /><br />이제 D3D 객체와 D3D 장치를 생성하는 InitD3D 함수를 살펴봅시다. D3D를 이용해서 자원을 로딩하거나 렌더링을 하려면 반드시 D3D장치를 생성해야 합니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// D3D 객체 및 장치 초기화</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bool InitD3D(HWND hWnd)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">우선 Direct3D 객체를 구합니다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // D3D 객체</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; gpD3D = Direct3DCreate9( D3D_SDK_VERSION );<span class="Apple-tab-span" style="white-space: pre;"> </span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if ( !gpD3D )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; return false;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><br />그 다음에는 D3D 장치를 생성할 때 필요한 구조체에 정보를 채워 넣겠습니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // D3D장치를 생성하는데 필요한 구조체를 채워 넣는다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; D3DPRESENT_PARAMETERS d3dpp;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; ZeroMemory( &amp;d3dpp, sizeof(d3dpp) );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.BackBufferWidth &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= WIN_WIDTH;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.BackBufferHeight &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = WIN_HEIGHT;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.BackBufferFormat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = D3DFMT_X8R8G8B8;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.BackBufferCount &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 1;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.MultiSampleType &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= D3DMULTISAMPLE_NONE;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.MultiSampleQuality &nbsp; &nbsp; &nbsp; &nbsp; = 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.SwapEffect &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = D3DSWAPEFFECT_DISCARD;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.hDeviceWindow &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= hWnd;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.Windowed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = TRUE;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.EnableAutoDepthStencil &nbsp; &nbsp; = TRUE;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.AutoDepthStencilFormat &nbsp; &nbsp; = D3DFMT_D24X8;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.Flags &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= D3DPRESENTFLAG_DISCARD_DEPTHSTENCIL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.FullScreen_RefreshRateInHz = 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; d3dpp.PresentationInterval &nbsp; &nbsp; &nbsp; = D3DPRESENT_INTERVAL_ONE;</span><br /><br /><br />위에서 주목할만한 정보들은 다음과 같습니다.<br /><br /><ul><li>BackBufferWidth: 백버퍼(렌더링 영역)의 너비</li><li>BackBuferHeight: 백버퍼의 높이</li><li>BackBufferFormat: 백버퍼의 포맷</li><li>AutoDepthStencilFormat: 깊이/스텐실 버퍼의 포맷</li><li>SwapEffect: 백버퍼를 스왑(swap)할 때의 효과. 성능 상 D3DSWAPEFFECT_DISCARD를 사용하는 것이 좋습니다.</li><li>PresentationInterval: 모니터 주사율과 백버퍼를 스왑하는 빈도간의 관계. D3DPRESENT_INTERVAL_ONE은 모니터가 수직동기될 때마다 백버퍼를 스왑해 줍니다. 게임에서는 성능상 모니터의 수직동기를 기다리지 않고 곧바로 스왑해 주는 경우가 많습니다.(D3DPRESENT IMMEDIATE). 단, 이럴 땐 전 프레임과 현재 프레임이 서로 찢겨 보이는 부작용이 있습니다.</li></ul><br /><br />이제 위에서 채워 넣은 정보들을 이용해서 D3D장치를 생성합니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // D3D장치를 생성한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if( FAILED( gpD3D-&gt;CreateDevice( D3DADAPTER_DEFAULT, D3DDEVTYPE_HAL, hWnd,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; D3DCREATE_HARDWARE_VERTEXPROCESSING,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &amp;d3dpp, &amp;gpD3DDevice ) ) )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; return false;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return true;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />D3D 자원을 읽어오는 LoadAssets() 함수 안에는 현재 아무 내용도 들어있지 않습니다. 이 책을 진행하면서 텍스처, 쉐이더, 모델 등을 읽어올 일이 있을 때마다 이 함수 안에서 LoadShader(), LoadTexture(), LoadModel() 함수들을 호출하겠습니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bool LoadAssets()</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 텍스처 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 쉐이더 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 모델 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return true;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />다음은 .fx 포맷으로 저장된 쉐이더 파일을 불러오는 LoadShader() 함수입니다. .fx파일은 정점쉐이더와 픽셀쉐이더를 모두 포함하고 있는 텍스트 파일로 D3DXCreateEffectFromFile() 함수를 통해 로딩 및 컴파일합니다. 따라서 HLSL코드에 문법적인 오류가 있다면 이 함수를 호출하는 도중에 쉐이더 컴파일 에러가 나겠죠? 그럴 때는 D3DXCreateEffectFromFile()의 마지막 매개변수를 통해 에러메시지를 구해올 수 있습니다. 이 에러메시지를 비주얼 C++의 출력 창에 보여주도록 하겠습니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 쉐이더 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPD3DXEFFECT LoadShader(const char * filename )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; LPD3DXEFFECT ret = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; LPD3DXBUFFER pError = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; DWORD dwShaderFlags = 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#if _DEBUG</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; dwShaderFlags |= D3DXSHADER_DEBUG;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#endif</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; D3DXCreateEffectFromFile(gpD3DDevice, filename,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; NULL, NULL, dwShaderFlags, NULL, &amp;ret, &amp;pError);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 쉐이더 로딩에 실패한 경우 output창에 쉐이더</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 컴파일 에러를 출력한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if(!ret &amp;&amp; pError)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; int size &nbsp;= pError-&gt;GetBufferSize();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; void *ack = pError-&gt;GetBufferPointer();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; if(ack)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char* str = new char[size];</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(str, (const char*)ack, size);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OutputDebugString(str);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delete [] str;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return ret;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />위에서 D3DXCreateEffectFromFile() 함수를 호출할 때 사용한 인자들의 의미는 순서대로 아래와 같습니다.<br /><br /><ul><li>gpD3DDevice: D3D 장치</li><li>filename: 읽어올 쉐이더 파일의 이름</li><li>NULL: 쉐이더를 컴파일 할 때 추가로 사용할 #define 정의</li><li>NULL: #include 지시문을 처리할 때 사용할 인터페이스 포인터</li><li>dwShaderFlags: 쉐이더를 컴파일 할 때 사용할 플래그</li><li>NULL: 매개변수 공유에 사용할 이펙트 풀</li><li>ret: 로딩된 이펙트를 저장할 포인터</li><li>pError: 컴파일러 에러 메시지를 가리킬 포인터</li></ul><br /><br />다음은 .x 포맷으로 저장된 모델을 로딩해오는 코드입니다. .x 파일은 DirectX에서 자체적으로 지원하는 메쉬 포맷입니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 모델 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPD3DXMESH LoadModel(const char * filename)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; LPD3DXMESH ret = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if ( FAILED(D3DXLoadMeshFromX(filename,D3DXMESH_SYSTEMMEM, gpD3DDevice,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; NULL,NULL,NULL,NULL, &amp;ret)) )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; OutputDebugString("모델 로딩 실패: ");</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; OutputDebugString(filename);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; OutputDebugString("\n");</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; };</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return ret;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />위에서 D3DXLoadMeshFromX() 호출에 사용했던 매개변수의 의미는 순서대로 다음과 같습니다.<br /><br /><ul><li>filename: 로딩해 올 메쉬의 파일명</li><li>D3DXMESH_SYSTEMMEM: 시스템 메모리에 메쉬를 로딩할 것</li><li>gpD3DDevice: D3D 장치</li><li>NULL: 인접 삼각형 데이터를 따로 구해오지 않음.</li><li>NULL: 머테리얼(material) 정보를 따로 구해오지 않음</li><li>NULL: 이펙트 인스턴스를 따로 구해오지 않음</li><li>NULL: 머테리얼 수를 따로 구해오지 않음</li><li>ret: 로딩해온 메쉬를 저장할 포인터</li></ul><br /><br />아래는 다양한 포맷으로 저장된 이미지들을 텍스처로 로딩해 오는 LoadTexture() 함수입니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 텍스처 로딩</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">LPDIRECT3DTEXTURE9 LoadTexture(const char * filename)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; LPDIRECT3DTEXTURE9 ret = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if ( FAILED(D3DXCreateTextureFromFile(gpD3DDevice, filename, &amp;ret)) )</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; OutputDebugString("텍스처 로딩 실패: ");</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; OutputDebugString(filename);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; OutputDebugString("\n");</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; return ret;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><br />다음은 게임루프 함수인 PlayDemo()입니다. 이 함수는 처리할 윈도우 메시지가 없을 때마다 호출됩니다. 실제 게임에서는 지난 프레임으로부터 경과한 시간을 구해서 업데이트 및 렌더링에 사용할 테지만 이 프레임워크에서는 간략함을 위해 그 부분을 생략했습니다.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 게임루프</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void PlayDemo()</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; Update();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; RenderFrame();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />현재 Update() 함수에는 아무 내용도 없습니다. 나중에 필요하다면 코드를 채워 넣도록 하지요.<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 게임로직 업데이트</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void Update()</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />다음은 정작 무언가를 그리는 함수인 RenderFrame()입니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 렌더링</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void RenderFrame()</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><br />우선 화면을 파란색으로 지웁니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; D3DCOLOR bgColour = 0xFF0000FF;<span class="Apple-tab-span" style="white-space: pre;"> </span>// 배경색상 - 파랑</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; gpD3DDevice-&gt;Clear( 0, NULL, (D3DCLEAR_TARGET | D3DCLEAR_ZBUFFER),</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; bgColour, 1.0f, 0 );</span><br /><br />그 후, 장면(scene)과 디버그 정보를 그립니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; gpD3DDevice-&gt;BeginScene();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; RenderScene();<span class="Apple-tab-span" style="white-space: pre;">  </span>// 3D 물체등을 그린다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; RenderInfo();<span class="Apple-tab-span" style="white-space: pre;">  </span>// 디버그 정보 등을 출력한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; gpD3DDevice-&gt;EndScene();</span><br /><br /><br />모든 그리기를 마쳤다면 백 버퍼에 저장되어 있는 렌더링 결과를 화면에 뿌려줍니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; gpD3DDevice-&gt;Present( NULL, NULL, NULL, NULL );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><br />현재 3D 물체 등을 그리는 RenderScene() 함수에는 아무 코드도 들어있지 않습니다. 다음 장에서 3D 물체를 그릴 때 여기에 코드를 채워 넣도록 하지요.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 3D 물체 등을 그린다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void RenderScene()</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />RenderInfo() 함수는 간단한 키 매핑 정보를 화면에 보여줍니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 디버그 정보 등을 출력.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void RenderInfo()</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 텍스트 색상</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; D3DCOLOR fontColor = D3DCOLOR_ARGB(255,255,255,255); &nbsp; </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 텍스트를 출력할 위치</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; RECT rct;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; rct.left=5;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; rct.right=WIN_WIDTH / 3;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; rct.top=5;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; rct.bottom = WIN_HEIGHT / 3;</span><br /><span class="Apple-tab-span" style="font-family: 'Courier New', Courier, monospace; white-space: pre;"> </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 키 입력 정보를 출력</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; gpFont-&gt;DrawText(NULL, "데모 프레임워크\n\nESC: 데모종료", -1, &amp;rct,</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; 0, fontColor );</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />프로그램을 종료할 때, GPU상의 메모리 누수를 방지하려면 D3D를 통해 생성했던 자원들을 모두 해제(release)해줘야 합니다. 자원들을 모두 해제한 뒤에는 D3D 장치와 D3D 객체들도 해제해 줍니다.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">// 뒷정리 코드.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">//------------------------------------------------------------</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">void Cleanup()</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">{</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 폰트를 release 한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if(gpFont)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; gpFont-&gt;Release();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; gpFont = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 모델을 release 한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 쉐이더를 release 한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // 텍스처를 release 한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; // D3D를 release 한다.</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if(gpD3DDevice)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; gpD3DDevice-&gt;Release();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; gpD3DDevice = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; if(gpD3D)</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; gpD3D-&gt;Release();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; gpD3D = NULL;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; }</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><br />자, 이것으로 아주 간단한 쉐이더 프레임워크의 작성을 마쳤습니다. 위의 코드가 잘 이해가 안 되시는 분들이 계실지도 모르겠는데, 이 책에서 HLSL 프로그래밍을 익히는 데는 크게 문제가 안됩니다. 단, 그래픽 프로그래머가 되는 것이 꿈이신 분들은 이 책을 마친 뒤에라도 반드시 DirectX를 제대로 배우시라고 권해드리고 싶습니다.<br /><br />여기까지 다소 지루한 준비과정을 견뎌내시느라 수고하셨습니다. 후딱 정리를 마친 뒤에 다음 장부터 실제로 재미있게 쉐이더를 작성해 보기로 하죠!<br /><br /><span class="Apple-style-span" style="font-size: x-large;"><b>정리</b></span><br />다음은 이 장에서 배운 내용을 짧게 요약해 놓은 것입니다.<br /><br /><ul><li>쉐이더는 어느 픽셀을 어떤 색으로 칠할지를 계산하는 함수이다.</li><li>쉐이더를 화가가 그림을 그리는 것에 비유하면 정점쉐이더는 투시를 픽셀쉐이더는 명암을 담당한다.</li><li>쉐이더 프로그래밍이란 정점쉐이더와 픽셀쉐이더에서 실행시킬 함수를 작성하는 것이다.</li><li>AMD사의 렌더몽키를 사용하면 재빨리 쉐이더를 프로토타입할 수 있다.</li></ul><br />
<div style="text-align: right;"><b><a href="http://kblog.popekim.com/2011/12/02-part-1.html">다음편 보기</a></b></div>
                    
                    
                    
                    <section class="pt-5 pb-3 text-center welcome-to-pocu">
                        <a href="https://pocu.academy/ko/Courses/COMP2200" class="d-inline-block border text-decoration-none text-left rounded to-pocu" id="a001">
                            <div class="d-flex flex-row align-content-center">
                                <div class="d-none d-md-block border border-top-0 border-bottom-0 border-left-0">
                                    <img src="https://blog.pocu.academy/ko/assets/img/logos/COMP2200.png" alt="img" />
                                </div>
                                <div class="d-flex flex-column justify-content-center px-4 py-3">
                                    <h2 class="headlines font-weight-bold">
                                        포인터의 확실한 이해 | C 언어 독학 | 모든 프로그래밍 언어의 어머니
                                    </h2>
                                    <p class="description m-0">5차 산업혁명을 책임질 컴퓨터 하드웨어 지식! POCU 아카데미에서 C 언어를 마스터하세요!</p>
                                </div>
                            </div>
                        </a>
                    </section></section>
                
                <footer class="pt-4 pt-md-5">
                    <h2 class="h4">관련 글</h2>
                    <ul class="list-unstyled">
                        
                        <li><a href="/ko/2012/01/30/intro-to-shader-06-toon-shader.html">[포프의 쉐이더 입문강좌] 06. 만화같은 명암을 입히는 툰쉐이더</a></li>
                        
                        <li><a href="/ko/2012/01/23/intro-to-shader-05-diffuse-specular-shader-part-2.html">[포프의 쉐이더 입문강좌] 05. 물체에 색을 입히는 디퓨즈/스페큘러 매핑 Part 2</a></li>
                        
                        <li><a href="/ko/2012/01/16/intro-to-shader-05-diffuse-specular-shader-part-1.html">[포프의 쉐이더 입문강좌] 05. 물체에 색을 입히는 디퓨즈/스페큘러 매핑 Part 1</a></li>
                        
                    </ul>
                </footer>
                
                <footer>
                    
<script src="https://giscus.app/client.js"
    data-repo="popekim/blog.popekim.com-comments-ko"
    data-repo-id="R_kgDOOND35A"
    data-category="Comments"
    data-category-id="DIC_kwDOOND35M4CoXGy"
    data-mapping="pathname"
    data-strict="1"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="ko"
    crossorigin="anonymous"
    async>
</script>
                </footer>
            </article>
        </div>
    </div>
</div>
    </div>
    
    <footer class="site-footer position-absolute border-top">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-5 pl-sm-0 pl-lg-6">
                <div>
                    <span class="ml-1">Copyright © 2010 - 2025. Pope Kim</span>
                </div>
            </div>
            <div class="col col-md-5 m-0 p-sm-0 text-md-right">
                <a class="mr-sm-3 mr-0 text-secondary text-nowrap font-weight-bold" href="/en">English</a>
                <span class="h5 opacity-75"><a href="/ko/feed.xml" class="badge badge-dark"><i class="fas fa-rss"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.youtube.com/c/PopeTV/" class="badge badge-dark" target="_blank"><i class="fab fa-youtube"></i></a></span>
                <span class="h5 opacity-75"><a href="https://x.com/blindrendererkr" class="badge badge-dark" target="_blank"><i class="fab fa-twitter"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.linkedin.com/in/popekim/" class="badge badge-dark" target="_blank"><i class="fab fa-linkedin-in"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.github.com/popekim/" class="badge badge-dark" target="_blank"><i class="fab fa-github"></i></a></span>
            </div>
        </div>
    </div>
</footer>
    
<script src="/ko/assets/lib/jquery/jquery-3.7.1.slim.min.js"></script>
<script src="/ko/assets/lib/bootstrap/js/bootstrap.bundle.js"></script>
<script src="/ko/assets/lib/prism/js/prism.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-asm6502.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-c.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-cpp.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-csharp.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-java.min.js"></script>
<script src="/ko/assets/js/prism/prism-masm.min.js"></script>
<script src="/ko/assets/js/saveLangToCookie.js" type="text/javascript"></script>

</body>

</html>