<!DOCTYPE html>
<html lang="ko">


<head>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NHD74QDQ');</script>
    <!-- End Google Tag Manager -->


    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    <title>Page 10 of 15 for Dev | 포프머신</title>
    
    
    
    <link rel="stylesheet" href="/ko/assets/lib/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/ko/assets/css/site.css?1762029392655704193" />
    <link rel="stylesheet" href="/ko/assets/css/prism-pocu.min.css" />

    <link rel="shortcut icon" href="/ko/assets/favicon.ico" />

    <link rel="canonical" href="https://blog.popekim.com/ko/categories/dev/page/10/index.html" />

<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed.xml" title="포프머신 | 모든글" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/dev.xml" title="포프머신 | 개발" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/music.xml" title="포프머신 | 음악" />
<link type="application/atom+xml" rel="alternate" href="https://blog.popekim.com/ko/feed/personal.xml" title="포프머신 | 개인" />

    

    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous"></script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1575918182992085" crossorigin="anonymous"></script>
    

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&subset=korean&display=block" rel="stylesheet">
</head>

<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NHD74QDQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    
<nav class="navbar navbar-expand-lg fixed-top navbar-light shadow-sm px-3 px-sm-0 py-lg-3 bg-white">
    <div class="container">
        <a class="navbar-brand" href="/ko/">
            <img class="mt-2 mb-2" src="/ko/assets/img/navbar_logo.png" />
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
<ul class="navbar-nav ml-auto mr-lg-3">
    <li class="nav-item">
        <a class="nav-link font-weight-bold" href="/ko/about.html">소개</a>
    </li>
    <li class="nav-item">
        <a class="nav-link font-weight-bold " href="/ko/books.html">저서목록</a>
    </li>
    <li class="nav-item">
        <a class="nav-link font-weight-bold" href="/ko/archives/">모든글</a>
    </li>
    
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/dev">cat:개발</a>
        </li>
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/music">cat:음악</a>
        </li>
    
        
        
        
        <li class="nav-item">
            <a class="nav-link font-weight-bold" href="/ko/categories/personal">cat:개인</a>
        </li>
    
</ul>

        </div>
    </div>
</nav>

    <div class="container doc">
        <div class="pt-4 pb-0"><ul class="post-list list-unstyled"><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/02/04/sharing-animations-between-different.html">
                        <section>
                            <h3>
                                유니티에서 topology가 같은 캐릭터간에 애니메이션 공유하기...
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/02/00.jpg"/>
                            
                            <p>
이미지 출처: http://answers.unity3d.com/questions/191282/sharing-animations-between-models.html
</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-02-04
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/unity/">unity</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/02/01/new-technique-is-not-new-toy.html">
                        <section>
                            <h3>
                                새로운 기법 != 새 장난감
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/02/03.jpg"/>
                            
                            <p>게임데브포에버에 무슨 글을 올릴까 고민을 좀 해봤는데… 그래픽 전문자료들은 이미 다른 필자분들이 열심히 올리고 계셔서 요번에는 그냥 제 경험담을 올리도록 하지요.. (이런 글을 원하시는 분들도 꽤 계실듯…?)
</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-02-01
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/dev-diary/">개발일지</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/31/fix-for-esc-not-working-while-using-photoshop-cs3.html">
                        <section>
                            <h3>
                                포토샵 CS3가 실행중이면 ESC 키가 작동하지 않는 버그 고치기
                            </h3>
                            <p>포토샵 CS3를 열어두면 윈도우 전역적으로 ESC 키가 먹히지 않는 문제가 있었다. 한마디로 짜증이었던 게지 -_-;;; CS5는 이 문제를 고쳤던데… CS5로 업그레이드 해달라고 회사에 부탁해도 현재 프로젝트에서 쓰는 버전이 CS3이니 그럴수 없단다…
</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-31
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/photoshop/">포토샵</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/30/intro-to-shader-06-toon-shader.html">
                        <section>
                            <h3>
                                [포프의 쉐이더 입문강좌] 06. 만화같은 명암을 입히는 툰쉐이더
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/01/13.jpg"/>
                            
                            <p>이 장에서 새로 배우는 HLSL
</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-30
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/book/">도서</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader-book/">셰이더강좌</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/25/detail-map-and-gamma-correction.html">
                        <section>
                            <h3>
                                디테일맵과 감마보정에 대한 뻘쭘 경험담
                            </h3>
                            <p>디퓨즈 맵에 디테일 맵을 곱하는 방법은 텍스처 타일링으로 인해 발생하는 반복패턴을 숨길 때 사용할 수 있는 좋은 방법입니다.
</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-25
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/dev-diary/">개발일지</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/23/intro-to-shader-05-diffuse-specular-shader-part-2.html">
                        <section>
                            <h3>
                                [포프의 쉐이더 입문강좌] 05. 물체에 색을 입히는 디퓨즈/스페큘러 매핑 Part 2
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/01/11.jpg"/>
                            
                            <p>이전편 보기픽셀쉐이더픽셀쉐이더도 전체 소스코드를 보여드린 뒤, 새로 추가된 내용만 설명 드립니다.struct PS_INPUT{&nbsp; &nbsp;float2 mUV : TEXCOORD0;&nbsp; &nbsp;float3 mDiffuse : TEXCOORD1;&nbsp; &nbsp;float3 mViewDir: TEXCOORD2;&nbsp; &nbsp;float3 mReflection: TEXCOORD3;};sampler2D DiffuseSampler;sampler2D SpecularSampler;float3 gLightColor;float4 ps_main(PS_INPUT Input) : COLOR{&nbsp; &nbsp;float4 albedo = tex2D(DiffuseSampler, Input.mUV);&nbsp; &nbsp;float3 diffuse = gLightColor * albedo.rgb * saturate(Input.mDiffuse);&nbsp; &nbsp;float3 reflection = normalize(Input.mReflection);&nbsp; &nbsp;float3 viewDir = normalize(Input.mViewDir);&nbsp; &nbsp;float3 specular = 0;&nbsp; &nbsp;if ( diffuse.x &gt; 0 )&nbsp; &nbsp;{&nbsp; &nbsp; &nbsp; specular = saturate(dot(reflection, -viewDir ));&nbsp; &nbsp; &nbsp; specular = pow(specular, 20.0f);&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; float4 specularIntensity &nbsp;= tex2D(SpecularSampler, Input.mUV);&nbsp; &nbsp; &nbsp; specular *= specularIntensity.rgb * gLightColor;&nbsp; &nbsp;}&nbsp; &nbsp;float3 ambient = float3(0.1f, 0.1f, 0.1f) * albedo;&nbsp; &nbsp;return float4(ambient + diffuse + specular, 1);}우선 새로 렌더몽키에 추가했던 세 변수를 전역적으로 선언하겠습니다.sampler2D DiffuseSampler;sampler2D SpecularSampler;float3 gLightColor;그리고 PS_INPUT구조체에 UV좌표를 추가합니다.&nbsp; float2 mUV : TEXCOORD0;이제 픽셀쉐이더 함수의 젤 윗줄에서 디퓨즈맵을 샘플링 해보죠.&nbsp; &nbsp;float4 albedo = tex2D(DiffuseSampler, Input.mUV);이것이 바로 현재 픽셀이 반사하는 색깔입니다. 여기에 난반사광의 양과 빛의 색상을 곱해야 한다고 했죠? 이전에 diffuse변수를 구하던 코드를 다음과 같이 바꿉니다.&nbsp; &nbsp;float3 diffuse = gLightColor * albedo.rgb * saturate(Input.mDiffuse);이제 한번 F5를 눌러서 정점쉐이더와 픽셀쉐이더를 각각 컴파일 한 뒤, 미리 보기 창을 한 번 봐볼까요?그림 5.3. 디퓨즈맵만 적용한 결과담벽 텍스처가 보이죠? 푸르스름한 빛도 보이네요. 근데 스페큘러맵을 아직 쓰지 않아서인지 정 반사광이 너무 강하네요. 돌 사이의 틈새까지도 말이지요! 그럼 스페큘러맵을 더해보도록 하죠.팁: 미리 보기 창에서 물체를 회전하는 법그림 5.3 처럼 틈새에 빛이 들어오게 하려면 물체를 회전하셔야 할 겁니다. 미리 보기 창에서 물체를 회전하시려면 창 안에 왼쪽 마우스 버튼을 누른 채 마우스를 이리저리 움직여보세요. 만약 회전 대신에 이동이나 확대/축소가 된다면 툴바에서 오른쪽 두 번째 아이콘(Overloaded Camera Mode)을 눌러주시면 됩니다.픽셀쉐이더에서 specular 변수의 거듭제곱을 구하는 코드(pow함수 호출) 바로 밑에서 스페큘러맵을 샘플링 합니다.&nbsp; &nbsp; &nbsp; float4 specularIntensity &nbsp;= tex2D(SpecularSampler, Input.mUV);이제 이것과 빛의 색상을 specular에 곱해야겠죠? 코드는 다음과 같습니다.&nbsp; &nbsp; &nbsp; float4 specularIntensity &nbsp;= tex2D(SpecularSampler, Input.mUV);&nbsp; &nbsp; &nbsp; specular *= specularIntensity.rgb * gLightColor;위 그림에서 또 다른 문제점 하나는 난 반사광이 사라지는 순간부터 디퓨즈 텍스처의 디테일도 사라진다는 것입니다. 이것은 주변광 값으로 (0.1, 0.1, 0.1)만을 사용했기 때문인데요. 주변광은 그냥 저희가 임의로 정한 빛의 양이므로 여기에도 디퓨즈맵을 곱해주는 것이 맞습니다.&nbsp;ambient변수를 구하는 코드를 찾아 다음과 같이 바꿔주세요.float3 ambient = float3(0.1f, 0.1f, 0.1f) * albedo;다시 한번 정점쉐이더와 픽셀쉐이더를 컴파일 한 뒤 미리 보기 창을 볼까요?그림 5.4. 스페큘러맵과 주변광까지 제대로 적용한 결과확실한 차이를 볼 수 있죠? 정 반사광이 그렇게 강하지도 않고, 틈새도 완벽하네요. 거기다가 어두운 픽셀에서도 디퓨즈맵의 흔적을 찾아 볼 수 있네요.선택사항: DirectX 프레임워크이제 C++로 작성한 DirectX 프레임워크에서 쉐이더를 사용하시려는 분들을 위한 선택적인 절입니다.우선 저번 장에서 사용했던 프레임워크의 사본을 만들어 새로운 폴더에 저장합니다. 그 다음, 렌더몽키에서 사용했던 쉐이더와 3D 모델을 DirectX 프레임워크에서 사용할 수 있도록 파일로 저장합니다. Sphere.x와 SpecularMapping.fx라는 파일이름을 사용하도록 하겠습니다. 또한 렌더몽키에서 사용했었던 텍스처 2개를 복사해다가 프레임워크 폴더에 저장합니다. Fieldstone_DM.tga와 Fieldstone_SM.tga로 이름을 사용하지요.이제 비주얼 C++ 솔루션 파일을 연 뒤, 소스코드에서&nbsp;gpLightingShader&nbsp;변수가 언급된 곳을 모두 찾아gpSpecularMappingShader로 변경합니다.그 다음, 전역변수 섹션에 가서 두 텍스처를 저장할 포인터들과 빛의 색상을 저장하는 변수를 선언합니다.// 텍스처LPDIRECT3DTEXTURE9 &nbsp; &nbsp; &nbsp; &nbsp;gpStoneDM &nbsp; &nbsp;= NULL;LPDIRECT3DTEXTURE9 &nbsp; &nbsp; &nbsp; &nbsp;gpStoneSM &nbsp; &nbsp;= NULL;// 빛의 색상D3DXVECTOR4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gLightColor(0.7f, 0.7f, 1.0f, 1.0f);렌더몽키에서 사용했던 푸르스름한 빛의 값인 (0.7, 0.7, 1.0)을 그대로 사용하는 거 보이시죠? 위에서 새로운 D3D 자원(텍스처)을 둘 선언했으니 이들을 해제하는 코드를 추가하도록 하죠. CleanUp() 함수에 다음의 코드를 추가합니다.&nbsp; &nbsp; // 텍스처를 release 한다.&nbsp; &nbsp; if ( gpStoneDM )&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; gpStoneDM-&gt;Release();&nbsp; &nbsp; &nbsp; &nbsp; gpStoneDM = NULL;&nbsp; &nbsp; }&nbsp; &nbsp; if ( gpStoneSM )&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; gpStoneSM-&gt;Release();&nbsp; &nbsp; &nbsp; &nbsp; gpStoneSM = NULL;&nbsp; &nbsp; }이제 D3D자원들을 로딩할 차례입니다. LoadAssets() 함수에 다음의 코드를 더합니다.&nbsp; &nbsp; // 텍스처 로딩&nbsp; &nbsp; gpStoneDM = LoadTexture("Fieldstone_DM.tga");&nbsp; &nbsp; if ( !gpStoneDM )&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; return false;&nbsp; &nbsp; }&nbsp; &nbsp; gpStoneSM = LoadTexture("Fieldstone_SM.tga");&nbsp; &nbsp; if ( !gpStoneSM )&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; return false;&nbsp; &nbsp; }쉐이더 파일의 이름을 SpecularMapping.fx로 바꿔주는 것도 잊지 맙시다.&nbsp; &nbsp; gpSpecularMappingShader = LoadShader("SpecularMapping.fx");이제 마지막으로 RenderScene() 함수를 봅시다. 이미 쉐이더가 모든 일을 하고 있으니 간단히 새로운 변수들을 대입해주기만 하면 되겠네요. 예전에 SetMatrix() 함수들을 호출 해주던 곳이 있었죠? 그 아래에 다음의 코드를 추가합시다.&nbsp; &nbsp; gpSpecularMappingShader-&gt;SetVector("gLightColor", &amp;gLightColor);&nbsp; &nbsp; gpSpecularMappingShader-&gt;SetTexture("DiffuseMap_Tex", gpStoneDM);&nbsp; &nbsp; gpSpecularMappingShader-&gt;SetTexture("SpecularMap_Tex", gpStoneSM);위 코드는 빛의 색상과 두 텍스처맵을 쉐이더에 전달해 줍니다. 텍스처맵을 대입해 줄 때 _Tex 접미사를 붙여줘야 한다는 건 '제3장: 텍스처매핑'에서 설명했었죠?이제 코드를 컴파일 한 뒤, 프로그램을 실행하면 렌더몽키에서와 동일한 결과를 보실 수 있을 겁니다.이쯤 되면 느끼셨겠지만 쉐이더를 사용하면 DirectX 프레임워크에서 책임져야 할 그래픽 관련 업무가 현저히 줄어듭니다. D3D 자원을 로딩하는 것과 쉐이더 매개변수, 그리고 렌더상태(render state)를 관리하는 것이 거의 전부입니다.정리다음은 이 장에서 배운 내용을 짧게 요약해 놓은 것입니다.인간이 물체의 색을 볼 수 있는 이유는 물체마다 흡수 및 반사하는 빛의 스펙트럼이 다르기 때문이다.3D 그래픽에서는 디퓨즈맵과 스페큘러맵을 사용하여 빛의 흡수 및 반사를 재현한다.스페큘러맵은 각 픽셀의 정 반사광을 조절하는 것을 주 목적으로 한다.빛의 색도 물체의 최종 색에 기여한다.텍스처는 색상정보만을 저장하는 것이 아니다. 스페큘러맵의 경우가 그 예이다.이 장은 예상보다 매우 쉽게 끝나버렸습니다. 저번 장에서 작성했던 조명쉐이더에 살을 붙였기 때문인데요. 이렇게 기본이 되는 쉐이더를 잘 짜놓으면 매우 쉽게 구현할 수 있는 기법들이 많습니다.하지만 이번 장에서 배운 내용을 절대 가볍게 보시지 말기 바랍니다. 최근 게임에서 3D 물체를 렌더링 할 때 여기서 배웠던 기법을 법선매핑(법선매핑(normal mapping)은 제7장에서 배웁니다)과 혼합하는 것이 거의 표준입니다.다음편 보기</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-23
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/book/">도서</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader-book/">셰이더강좌</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/18/feedback-for-my-kgc-2011-presentation.html">
                        <section>
                            <h3>
                                KGC 2011 강연자료 공개후 국/내외 반응
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/01/30.jpg"/>
                            
                            <p>뒤져보니 KGC 2011 발표자료를 공개한 뒤에 받은 피드백을 모아놓은 게 있었는데 깜박잊고 안올렸네요. 저 번에 블로그에 올렸던 강연 들으신 분의 피드백은 중복을 막기 위해 생략…
</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-18
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/presentation/">발표</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/16/intro-to-shader-05-diffuse-specular-shader-part-1.html">
                        <section>
                            <h3>
                                [포프의 쉐이더 입문강좌] 05. 물체에 색을 입히는 디퓨즈/스페큘러 매핑 Part 1
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/01/09.jpg"/>
                            
                            <p>이전편 보기샘플파일 받기제5장 물체에 색을 입히는 디퓨즈/스페큘러 매핑실 세계에서 물체들이 다른 색을 갖는 이유는 물체마다 흡수/반사하는 빛의 스펙트럼(spectrum)이 다르기 때문입니다. 예를 들면 검정색 표면은 모든 스펙트럼을 흡수해서 검정색이고, 하얀색 표면은 모든 스펙트럼을 반사해서 하얀색입니다. 빨간색 표면 같은 경우는 빨강색의 스펙트럼을 반사하고 그 외의 스펙트럼을 흡수하니 빨간색으로 보이는 것이죠.그렇다면 표면이 빛을 흡수하는 성질을 쉐이더에서 어떻게 표현할까요? 표면 전체가 한가지 색으로 칠해져 있다면 그냥 간단히 전역변수를 사용하면 되겠죠? 하지만 대부분의 경우, 물체의 표면은 다소 복잡한 패턴을 가지고 있습니다. 따라서 각 픽셀마다 색상을 정해줘야겠지요. 그럼 표면에서 반사할 색을 이미지로 그린 뒤, 픽셀쉐이더에서 이 텍스처를 읽어와 조명계산의 결과에 곱하면 되겠죠?그런데 '제4장: 기초적인 조명쉐이더'에서 빛을 계산할 때, 난 반사광(diffuse light)와 정 반사광(specular light)을 따로 구했었죠? 그렇다면 난 반사광과 정 반사광을 합친 결과에 이 텍스처를 곱해야 할까요? 아니면 따로 해야 할까요? 전에도 말씀드렸듯이 인간이 물체를 지각할 수 있는 이유는 대부분 난 반사광 덕분입니다. (정 반사광은 타이트한 하이라이트를 추가해줄 뿐이지요.) 따라서 위 텍스처를 난 반사광의 결과에만 적용하는 것으로 충분합니다. 이렇게 난 반사광에 적용하는 텍스처를 디퓨즈맵(diffuse map)이라 부릅니다.그렇다면 정 반사광은 어떻게 할까요? 물론 디퓨즈맵을 정 반사광에 그대로 사용할 수도 있습니다만 다음과 같은 두 가지 이유 때문에 정 반사광용으로 스페큘러맵(specular map)을 따로 만드는 경우가 허다합니다. 첫째, 난 반사광이 반사하는 빛과 정 반사광이 반사하는 빛의 스펙트럼이 다른 경우가 있습니다. 둘째, 각 픽셀이 반사하는 정 반사광의 정도를 조절하는 용도로 스페큘러맵을 사용할 수도 있습니다. 예를 들어, 사람의 얼굴에 정 반사광을 때린다고 생각해 보죠. '제4장: 기초적인 조명쉐이더'에서 봤던 것처럼 얼굴의 전체에서 고르게 정 반사광이 보일까요? 거울을 보시면 알겠지만 이마나 코가 더 반짝거리죠? 그리고 이마나 코에서도 정 반사광이 좀 듬성듬성 보일 겁니다. (이건 모공이나 털 때문에 피부가 매끄럽지 않기 때문입니다.) 스페큘러맵을 잘 칠하면 이런 효과를 낼 수 있습니다. 따라서 이 장에서는 디퓨즈맵과 스페큘러맵을 따로 사용하도록 하겠습니다.이 외에도 물체의 색에 영향을 미치는 다른 요소가 있습니다. 바로 조명의 색입니다. 흰색 물체에 빨간색 빛을 비추면 물체가 불그스름하게 되죠? 조명의 색은 전역변수로 쉽게 지정할 수 있습니다.여태까지 말씀 드린 것을 보기 쉽게 설명하면 다음과 같습니다.난 반사광 = 빛의 색상 X 난 반사광의 양 X 디퓨즈맵의 값정 반사광 = 빛의 색상 X 난 반사광의 양 X 스페큘러맵의 값그러면 위 내용들을 염두에 두고 디퓨즈/스페큘러매핑 쉐이더를 작성해 볼까요?기초설정일단 저번 장에서 사용했던 렌더몽키 프로젝트의 사본을 만들어 새로운 폴더에 저장합니다. 혹시 렌더몽키 프로젝트를 저장해 놓지 않으신 분들은 부록 CD에서 samples\04_lighting\lighting.rfx 파일을 복사해 오시면 됩니다.이 파일을 렌더몽키에서 연 다음, 쉐이더의 이름을 SpecularMapping으로 바꾸겠습니다. 이름까지 바꾸셨다면 이제 디퓨즈맵과 스페큘러맵으로 사용할 이미지들을 추가해야겠군요. 쉐이더 이름에 마우스 오른쪽 버튼을 누르면 나오는 팝업메뉴에서 Add Texture &gt; Add 2D Texture &gt; Fieldstone.tga파일을 선택합니다. 그러면 Fieldstone이라는 이름의 텍스처가 보이시죠? 이 이름을 DiffuseMap으로 바꾸도록 합시다.이제 Pass 0에 마우스 오른쪽 버튼을 눌러 Add Texture Object &gt; DiffuseMap을 선택합니다. Texture0이라는 텍스처 개체가 생겼을 것입니다. 이 이름을 DiffuseSampler로 변경합니다.이제 스페큘러맵을 추가해야 하는데 아무리 렌더몽키 폴더를 뒤져봐도 마땅한 놈이 안 보이는군요. 그래서 제 손으로 직접 스페큘러맵을 만들어서 부록 CD에 넣어놨습니다. 일단 이 스페큘러맵이 어떻게 생겼는지 한번 볼까요? 디퓨즈맵과 같이 비교해서 보면 좋겠군요그림 5.1. 디퓨즈맵(왼쪽)과 스페큘러맵(오른쪽)스페큘러맵에서 돌판 사이의 틈새를 검정색으로 칠해 놓은 거 보이시죠? 따라서 이 틈새는 전혀 정 반사광을 반사하지 않을 겁니다. (하지만 난 반사광은 여전히 존재하지요.) 여기서 한가지 기억하실 점은 텍스처가 언제나 색상정보를 가지지는 않는다는 것입니다. 스페큘러맵이 그 좋은 예죠. 스페큘러맵에 저장된 정보는 최종이미지의 색상 값이라기 보다는 각 픽셀이 반사하는 정 반사광의 양입니다. 이와 마찬가지로 픽셀 수준에서 제어하고 싶은 변수가 있다면 이렇게 텍스처를 사용하는 것이 보통입니다. 후에 법선매핑을 다룰 때, 이렇게 텍스처를 이용하는 예를 보실 수 있을 것입니다.팁: 픽셀수준에서 제어하고 싶은 변수가 있다면 텍스처를 이용합니다.자, 그럼 부록CD에서 Samples\05_DiffuseSpecularMapping\Fieldstone_SM을 찾아서 렌더몽키 프로젝트에 추가합니다. 추가하는 방법은 간단히 파일을 끌어다 이펙트 이름 위에 놓아주면 됩니다. 텍스처 이름은 SpecularMap으로, 텍스처 개체의 이름은 SpecularSampler로 하겠습니다.다음은 빛의 색을 추가하도록 하지요. 쉐이더 이름에 오른쪽 버튼을 누른 뒤에 Add Variable &gt; Float &gt; Float3를 선택합니다. 변수명을 gLightColor로 하지요. 이제 이 변수를 더블클릭하면 값을 대입할 수 있습니다. 약간 푸르스름한 빛을 사용한다는 의미로 (0.7, 0.7, 1.0)을 대입하겠습니다.마지막으로 Stream Mapping을 설정할 차례입니다. '제4장: 기초적인 조명쉐이더'와는 달리 여기서는 텍스처를 사용하니 정점데이터에서 UV 좌표를 읽어와야 합니다. Stream Mapping에 더블클릭을 해서 TEXCOORD0을 추가합니다. 당연히 데이터형은 float2입니다.여기까지 설정을 마치셨다면 렌더몽키 작업공간이 아래와 같을 겁니다.그림 5.2. 기초설정을 마친 렌더몽키 프로젝트정점쉐이더이제 정점쉐이더를 보도록 하지요. 우선 전체 소스코드부터 보여드린 뒤, 새로 추가된 코드만 설명 드리겠습니다.float4x4 gWorldMatrix;float4x4 gViewMatrix;float4x4 gProjectionMatrix;float4 gWorldLightPosition;float4 gWorldCameraPosition;struct VS_INPUT{&nbsp; &nbsp;float4 mPosition : POSITION;&nbsp; &nbsp;float3 mNormal: NORMAL;&nbsp; &nbsp;float2 mUV: TEXCOORD0;};struct VS_OUTPUT{&nbsp; &nbsp;float4 mPosition : POSITION;&nbsp; &nbsp;float2 mUV: TEXCOORD0;&nbsp; &nbsp;float3 mDiffuse : TEXCOORD1;&nbsp; &nbsp;float3 mViewDir: TEXCOORD2;&nbsp; &nbsp;float3 mReflection: TEXCOORD3;};VS_OUTPUT vs_main( VS_INPUT Input ){&nbsp; &nbsp;VS_OUTPUT Output;&nbsp; &nbsp;Output.mPosition = mul( Input.mPosition, gWorldMatrix );&nbsp; &nbsp;float3 lightDir = Output.mPosition.xyz - gWorldLightPosition.xyz;&nbsp; &nbsp;lightDir = normalize(lightDir);&nbsp; &nbsp; &nbsp;float3 viewDir = normalize(Output.mPosition.xyz - gWorldCameraPosition.xyz);&nbsp; &nbsp;Output.mViewDir = viewDir;&nbsp; &nbsp; &nbsp;Output.mPosition = mul( Output.mPosition, gViewMatrix );&nbsp; &nbsp;Output.mPosition = mul( Output.mPosition, gProjectionMatrix );&nbsp; &nbsp; &nbsp;float3 worldNormal = mul( Input.mNormal, (float3x3)gWorldMatrix );&nbsp; &nbsp;worldNormal = normalize(worldNormal);&nbsp; &nbsp;Output.mDiffuse = dot(-lightDir, worldNormal);&nbsp; &nbsp;Output.mReflection = reflect(lightDir, worldNormal);&nbsp; &nbsp;Output.mUV = Input.mUV;&nbsp; &nbsp; &nbsp;return Output;}새로 추가해야 할 전역변수가 있던가요? 새로 추가된 변수는 빛의 색상하고 2개의 텍스처 샘플러인데 텍스처 샘플러야 당연히 픽셀쉐이더에서 사용하는 거니까 여기선 선언하지 않아도 되겠네요. 빛의 색상도 픽셀쉐이더에서 그냥 곱하면 되겠는걸요?그렇다면 정점쉐이더 입출력 구조체는 어떨까요? 새로 추가해야 할 게 하나 생겼죠? 픽셀쉐이더에서 텍스처매핑을 하려면 UV 좌표가 필요하니까요. 정점버퍼에서 UV 좌표를 가져와서 픽셀쉐이더에 전달해 줘야겠네요. 다음의 코드를 정점쉐이더의 입력구조체와 출력구조체 양쪽에 모두 추가합시다.&nbsp; &nbsp; float2 mUV: TEXCOORD0;정점쉐이더 함수에 추가해야 할 코드도 딱 한 줄 뿐입니다. UV좌표를 전달해주는 것이죠.&nbsp; &nbsp;Output.mUV = Input.mUV;정말 간단했죠? 이게 전부랍니다.다음편 보기</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-16
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/book/">도서</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader-book/">셰이더강좌</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/11/compile-time-hash-string-generation.html">
                        <section>
                            <h3>
                                컴파일 중에 문자열해쉬 만들기....(를 시도해 보자? -_-)
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/01/01.jpg"/>
                            
                            <p>동기최근에 한동안 동고동락했던 게임엔진에서는 모든 것을 문자열(string)로 참조했었습니다. 물론 문자열 비교를 계속 해야하니 꽤 느린 방법이었지요. 그래서 이걸 빠르게 하기 위해 해쉬값(정수, int)을 사용했었더라죠.이놈이 대충 이렇게 동작했습니다. 일단 엔진에 싱글턴으로 해쉬 문자열 매니저가 있고요, 게임실행 도중에 문자열을 사용할 때마다 이 매니저를 통해서 해쉬 값을 받는데, 그때마다 해쉬 값과 문자열이 해쉬문자열 매니저안에 저장됩니다. 그리고 문자열을비교할 때는 그냥 해쉬 값만 비교하고, 실제 문자열을 char*가 필요할 때는 hashStringManager-&gt;GetString(hashKey); 이런 식으로 호출해 주면 되었죠.개인적으로는 이 시스템이 그닥 맘에 들지 않았는데요......-_- 그 이유는:메모리 낭비가 심하다:해쉬문자열 매니저에 저장된 놈 중에 정작 게임에서 char* 문자열로 형태로 사용하는 놈은 10% 정도 밖에 안되었습니다.따라서 90%는 그냥 룩업(look-up) 키처럼 해쉬값(int)만 사용할 뿐이었죠.즉, 90% 에 대해선 실제 char* 을 저장해 둘 필요가 없었습니다. 그냥 해쉬값만 있으면 충분했죠.그래서 한 생각이... .이 90%에 대해서는 굳이 해쉬값을 게임 실행중에 계산할게 아니라 오프라인에서(툴이나 컴파일 도중에) 만들어 주면 되겠다고....멀티쓰레딩을 할 때도 레이스(race) 컨디션이 없도록 하려다보니 해쉬문자열 매니저가 꽤 느려졌습니다. lock을 추가했는데, 특히 리소스 로딩도중에 여러 쓰레드가 이 lock을 걸려고 하다보니 이게 꽤 bottleneck이 걸리더라구요?실행파일이나 게임리소스 데이터파일에 들어가있는 문자열은 hex 에디터 하나만으로도 쉽게 볼 수 있으니....좀 더 해킹당할 위험이 클껄요...?그래서 이보다 좀 나은 방법을 찾아보자..... 하고 시도했던 게 바로... 이 밑에 아주 장황하게 설명하는 놈입니다...&nbsp;일단 문자열의 종류를 2가지로 나누자위에서 90%와 10%로 나눴던 문자열을 다른 포맷으로 저장하는게 우선입니다.1. char* 문자열 (10%)게임속에서 char* 형태로 사용해야 하는 문자열들은 (예전과 비슷하게) char[]포맷으로 저장합니다.게임실행중에 로딩해야할 파일의 이름들 (단, 파일이름마저 해쉬로 만들어서 1HDA3820.ext 라는 형식으로 저장하는 경우에는 예외겠죠... 근데 정말 이렇게까지 하는 게임들이 몇이나 있을까요.....? 머엉.... -_-)화면에 출력해야할 문장들: 게이머들에게&nbsp;0xFFFFF, 0x888888 또는 0x000000 따위로 대화창을 보여주고 싶진 않겠죠....? (아래 사진을 보니 그래도 될거 같긴.... &nbsp;^_^)Image Source:&nbsp;icanhascheeszburger.com대부분의 게임에서 쓰이는 문자열 중에 순수 char* 문자열이 필요한 경우는 대충 10% 정도 될테니까... 굳이 해쉬값을 계산하는 대신 곧바로 strcmp()로 한글자씩 문자열을 비교해도 될거 같은데요. 뭐, 정 해쉬값을 사용하려면 위에서 설명드렸던 해쉬 문자열 매니저를 사용해도 되구요. (최소한 예전에 비해 1/10정도의 문자열만 저장할테니 메모리 낭비는 적겠죠....)2. 해쉬값으로 표현한 문자열 (90%)위의 10%를 제외한 다른 문자열들, 즉 char* 형태가 전혀 사용되지 않는 문자열들은 그냥 간단히 해쉬값(int)로 저장합니다. 여기에 포함되는 문자열들로는 다음과 같은 놈들이 있죠.문자열 비교에만 쓰이는 놈(해쉬맵 등의) 룩업키로만 쓰이는 놈char* 문자열을 사용하는 법은 이미 다들 아실테니.... 두번째 방법인 해쉬값으로 표현하는 문자열에 대해서만 좀더 다루겠습니다.괜찮은 해쉬함수 고르기: x65599해쉬함수가 뭔지는 다들 아실란가요? 모르시는 분들을 위해 간단히 말하면 다른 문자열마다 독특한('고유한'이라고도 표현합니다) 정수값을 만들어 내줄려고 "노력"하는 함수입니다. ("노력"에 따옴표를 두른 이유는 해쉬함수가 독특한 정수값을 계산해내지는 못하는 경우가 있기 때문입니다. 이렇게 문자열이 서로 다른데도 동일한 해쉬값이 나오는 경우를 두고 해쉬 충돌이 생겼다고 하지요.) 뭐든간에 각 문자열마다 독특한 해쉬값을 만들어 내었다면 문자열을 비교할 때, 그 안에 있는 글자를 하나씩 비교할 필요 없이 그냥 해쉬값 2개만 비교하면 되지요. 이것의 장점? 아무래도 빠르죠. 간단하고... ^^그렇다면 문자열마다 고유한 해쉬값을 계산하는 방법은 뭘까요? 뭐... 이미 꽤 많은 해쉬함수들이 공개되어있지요. 각, 함수따라 해쉬 충돌이 나는 횟수도 좀 다르고, 속도도 다양합니다. 그냥 본인의 필요에 따라 가장 적절한 함수를 선택하면 됩니다. 제 개인적으로 생각하는 게임에 적합한 해쉬 함수는 다음과 같은 조건을 충족해야 합니다.해쉬 충돌이 거의 없어야 한다.컴파일 도중과 게임실행 중에 모두 사용할 수 있을 정도로 유연해야 한다: 예를 들어 게임실행도중에 두 문자열을 합친(concat) 뒤 그 결과물에 해쉬값을 계산하려 한다면 컴파일 시점만 아니라 런타임에서도 이 함수를 쓸 수 있어야 겠죠?게임속에서 사용할 수 있을 정도로 속도가 빨라야 한다.그래서 인터넷질을 좀 하던 도중&nbsp;Chrisis Savoie 아저씨네 블로그에서 해쉬함수를 비교해둔 차트를 찾았습니다. 차트를 쭉 둘러보니 x65599라고 불리는 해쉬함수가 저에게 가장 적합해 보이더군요. (그리고 이름도 멋지잖아요.. 앞에 X가 떡하니 붙으니.. 먼가 간지가 풀풀~ -_-;;; ) x65599는 성경책에 나오는 단어들을 모두 돌려도 해쉬 충돌이 없다더군요. (역시 위 링크 참조)그리고 실제 코드도 한번 봤는데(바로 아래 붙여놓았음) 매우 짧더군요. -_-;; 그냥 65599를 계속 곱해주면 끝(물론 오버플로우를 이용하는 거지만....) 아하! 그래서 이름이 x65599였군요.. ㅎㅎ... (참고로 65599는 소수(prime number)입니다. 해쉬값을 계산해 낼 때는 이렇게 소수를 많이 씁니다.)// 65599를 곱하는 해쉬함수. (Red Dragon 책에서 훔쳐옴 -0-)unsigned int generateHash(const char *string, size_t len){&nbsp; unsigned int hash = 0;&nbsp; for(size_t i = 0; i &lt; len; ++i)&nbsp; {&nbsp; &nbsp; &nbsp;hash = 65599 * hash + string[i];&nbsp; }&nbsp; return hash ^ (hash &gt;&gt; 16);}자, 그럼 그럴듯해 보이는 해쉬 함수도 골랐으니... 이제 툴과 게임코드에서 어떤 짓을 해야하는지 가볍게 살펴보죠.툴에서 데이터 세이브하기char * 값을 게임데이터로 저장하는 툴이 있다면, char * 대신 해쉬값(int)을 저장하도록 툴 코드를 바꿔줍니다. 뭐 그냥 저 위의 해쉬함수에 char* 를 인자로 호출한 뒤, 그 결과를 저장해 주면 됩니다. (툴이 C#처럼 다른 언어로 되어있으면 &nbsp;그 언어에서 똑같은 함수를 만들어주던가.. 아니면 interop으로 감싸주던가.... )간단하죠? 이러면 데이터에서 char*는 사라집니다. 이제 게임코드쪽으로 고고고,,,게임코드에서 컴파일시에 해쉬값 만들기예를 들어 게임코드에서 "funny_bone"이란 이름의 조인트를 찾으려 한다고 하죠. 예전 같으면 이런 코드를 썼겠죠.bones.find("funny_bone");근데 이제 툴에서 "funny_bone"이란 문자열 대신에 해쉬값을 저장하니... 이제는 대신 이렇게 코드를 작성해야 합니다.const char * boneToFind = "funny_bone";bones.find( generateHash(boneToFind, strlen(boneToFind) );근데 이렇게 하면 "funny_bone"이라는 문자열이 여전히 실행파일에 삽입되지 않을까요? &nbsp;만약 그렇다면 예전에 쓰던 해쉬문자열 매니저보다 메모리를 적게 잡아먹을리도 없겠고.... 으음.... 그렇다면.. 여태까지 왜 글을 쓴거지? -_-;;;; 는 아니고........위를 잘보면 문자열이 상수(const) 잖아요? 그럼 저기에 generateHash() 함수에서 하는 계산을 적용하면 나오는 그 결과 해쉬값(int)도 정해져 있을 수밖에 없죠.&nbsp;즉, 똑똑한 컴파일러라면 "아하! funny_bone이란 문자열이 이미 상수로 정의되어 있고 여기에 generateHash()란 함수를 호출하면서 이런저런 계산을 하는군. 그렇다면 굳이 프로그램 실행도중에 이런 계산을 할 필요가 없겠는걸? 컴파일 도중에 미리 해버려서 그 결과인 해쉬값'만' 코드에 넣으면 되지 않을까?" 라는 논리적 사고를 할 수 있어야 한다.... 는게 제 소망이자 바램이죠.. -_-;; 만약 컴파일러가 이리 똑똑할 수 있다면 컴파일 도중에 다음과 같이 코드가 바뀔 겁니다.// 0XF1C66FD7F이 실제 "funny_bone"의 해쉬값입니다.bones.find(&nbsp;0xF1C6FD7F&nbsp;); &nbsp; &nbsp;이런 마법은(?) 다음 두 조건만 충족된다면 가능합니다.컴파일러가 위 해쉬 함수를 인라인(inline)한다: 컴파일러가 해쉬함수를 인라인으로 삽입해주지 않으면 컴파일 도중에 해쉬값을 계산할 턱이 없지요. 그냥 함수를 호출할 테니까요. 따라서 이 조건이 반드시 충족되야 합니다. 대부분의 컴파일러에서 inline 키워드는 강제성이 없는 게 문제긴 한데... (가이드라인일 뿐)... 뭐 그닥 해결하기 어려운 문제는 아닙니다.컴파일러가 해쉬함수 안에 있는 for루프를 언롤(unroll )해 준다: 언롤이란 루프 코드가 있을 때, 각 루프 회차를 일일이 코드로 풀어서 써주는 걸 뜻합니다. 컴파일러가 컴파일시에 루프를 몇번 돌릴 지 예측할 수 있다면 이걸 일일이 풀어 써주는게 불가능하지만은 않죠....generateHash(const char *, size_t) 함수의 인라인우선 컴파일시에&nbsp;generateHash(const char*, size_t)&nbsp;함수가 인라인 될 수 있게 만들어줘야 겠죠. 그러려면 헤더파일에 함수본체를 넣는 방법이 최고입니다. 더 나아가, 문자열의 길이를 구하려고 strlen(const char *)함수를 따로 호출할 필요가 없도록 다음과 같은 매크로를 만들겠습니다.#define HASH_STRING(str) generateHash(str, strlen(str));이 매크로까지 들어간&nbsp;hash.h&nbsp;파일을 보여드리면 다음과 같습니다.// 컴파일 타임 해쉬문자열 만들기 테스트// author: Pope Kim (www.popekim.com)#include &lt;string.h&gt;#define HASH_STRING(str) generateHash(str, strlen(str));// 65599를 곱하는 해쉬함수. (Red Dragon 책에서 훔쳐옴 -0-)// 이 함수의 몸체까지 헤더파일에 넣어서 컴파일러의 인라인을 돕는다.inline unsigned int generateHash(const char *string, size_t len){&nbsp; unsigned int hash = 0;&nbsp; for(size_t i = 0; i &lt; len; ++i)&nbsp; {&nbsp; &nbsp; hash = 65599 * hash + string[i];&nbsp; }&nbsp; return hash ^ (hash &gt;&gt; 16);}테스트 코드이제 테스트 코드를 만들어 컴파일러와 최적화 옵션에 따라 원하는 결과(HASH_STRING(str)이 정수로 탈바꿈 하는 것... 물론 컴파일시에...)가 나오는지 살펴보겠습니다.이게 테스트 코드, main.cpp입니다.// 컴파일 타임 해쉬문자열 만들기 테스트// author: Pope Kim (www.popekim.com)#include &lt;stdio.h&gt;#include "hash.h"int main(int args, char** argv){&nbsp; unsigned int hashValue = HASH_STRING("funny_bone");&nbsp; printf("해쉬 값: 0x%8x\n", hashValue);&nbsp; return 0;}이제 컴파일러들이 얼마나 똑똑한지 알아봅시다 -_-;Visual Studio 2010 SP1비주얼 스튜디오에서 Win32 콘솔 프로젝트를 만든 뒤, 최적화 옵션을 바꿔가며 테스트 해봤습니다. (제가 영문 비졀 스튜디오를 써서 옵션은 대충 영문으로 남겨둡니다 -_-)프로젝트 설정을 Release로 바꿔줍니다.어셈블리 파일을 출력하기 위해 Project Properties &gt; C/C++ &gt; Output Files &gt; Assembler Output 옵션으로 가서 Assembly-Only Listing (/FA)을 선택 해줍니다.최적화 플래그를 바꿔주기 위해 Project Properties &gt; C/C++ &gt; Optimization으로 가서 아래의 최적화 옵션들을 바꿔줘가며 컴파일을 합니다.Disabled (/Od)주목할 만한 것은 대략 2가지....generateHash()&nbsp;함수가 인라인 안되었군요.. (뭐 최적화를 전혀 안했으니 당연한...?)재미있게도&nbsp;strlen()&nbsp;호출은 10으로 탈바꿈 했군요. push 10이라고 된 어셈코드를 보세요..._main PROC &nbsp; &nbsp; &nbsp;; COMDAT; File e:\temp\x65599\x65599\main.cpp; Line 11&nbsp;push ebp&nbsp;mov ebp, esp&nbsp;push ecx; Line 12&nbsp;push 10 &nbsp; &nbsp; ; 0000000aH&nbsp;push OFFSET $SG-5&nbsp;call ?generateHash@@YAIPBDI@Z &nbsp;; generateHash&nbsp;add esp, 8&nbsp;mov DWORD PTR _hashValue$[ebp], eax; Line 13&nbsp;mov eax, DWORD PTR _hashValue$[ebp]&nbsp;push eax&nbsp;push OFFSET $SG-6&nbsp;call DWORD PTR __imp__printf&nbsp;add esp, 8; Line 15&nbsp;xor eax, eax; Line 16&nbsp;mov esp, ebp&nbsp;pop ebp&nbsp;ret 0_main ENDPMinimize Size(/O1)최적화 끈 거와 별 차이는 없습니다. 해쉬함수가 인라인되긴 했는데 여전히 루프를 돌립니다. (문자열 길이인 10하고 비교한 뒤 다시 루프 처음으로 점프(jb)하는 부분을 보시면 암)_main PROC      ; COMDAT; File e:\temp\x65599\x65599\main.cpp; Line 12 xor ecx, ecx xor eax, eax$LL5@main: movsx edx, BYTE PTR ??_C@_0L@DDOFCBGB@funny_bone?$AA@[eax] imul ecx, 65599    ; 0001003fH add ecx, edx inc eax cmp eax, 10     ; 0000000aH jb SHORT $LL5@main mov eax, ecx shr eax, 16     ; 00000010H xor eax, ecx; Line 13 push eax push OFFSET ??_C@_0BF@DJEFNLLJ@hash?5value?5is?50x?$CF8x?6?$AA@ call DWORD PTR __imp__printf pop ecx pop ecx; Line 15 xor eax, eax; Line 16 ret 0_main ENDPMaximize Speed(/O2)오옷! 첫 줄을 봐봐요.&nbsp;push -238617217&nbsp;이게 16진수로&nbsp;0xF1C6FDF?이거든요. 모든 계산이 다 사라지고 해쉬값 하나로 탈바꿈 했군요! 이야! 역시 가능한 거였어요 -_- 흣~; Line 13 push -238617217    ; f1c6fd7fH push OFFSET ??_C@_0BF@DJEFNLLJ@hash?5value?5is?50x?$CF8x?6?$AA@ call DWORD PTR __imp__printf add esp, 8; Line 15 xor eax, eax; Line 16 ret 0_main ENDP그리고 여기서 나온 .exe파일을 텍스트 에디터에서 열어서 funny_bone이란 문자열이 있나 찾아보니 없군요!Full Optimization(/Ox)이 옵션으로도 어셈블리어는 그럴듯해 보입니다._main PROC      ; COMDAT; File e:\temp\x65599\x65599\main.cpp; Line 13 push -238617217    ; f1c6fd7fH push OFFSET $SG-6 call DWORD PTR __imp__printf add esp, 8; Line 15 xor eax, eax; Line 16 ret 0_main ENDP하지만 .exe파일을 열어서 funny_bone을 찾아보니...funny_bone이 왜 있는 건데...? 응?이거 뭐하자는 건지... -_- Full Optimization이 사용안하는 문자열 하나 제거하지 않다니.. 참으로 웃긴 일입니다. 이 외에도 다른 테스트 프로그램을 만들어서 실험해봐도 결과는 같았습니다. 심지어 이따위 함수를 만들고 컴파일해도 exe파일안에 스트링이 그대로 있더군요.void idiot(){&nbsp; const char* idiot = "OMG";}사실 .exe 파일 안까지 뒤져볼 생각은 첨에 안했었는데 진영군(denoil)이 안되는거 아니냐고 물어와서 그거 확인해보다 찾아낸 결과입니다. 진영군이 VS 2008과 VS2010 버전에서 실험했을때도 결과는 똑같이 개판이었어요 -_-;그래서 회사동료인 Karl하고 뒤적거리다 보니 C/C++ &gt; Code Generation &gt; Enable String Pooling이란 옵션이 있더군요. 이걸 Yes(/GF)로 켜주면 그제서야 문자열이 exe에서 사라집디다. 뭔 이유인진 모르겠지만 이 옵션이 /O1, /O2에는 켜있는데 /Ox에는 기본적으로 꺼져있더라는....g++그렇다면 g++ 컴파일러는 과연 어떨까요. 테스트에 사용한 g++ 버젼은 4.5.3이고.. 컴파일러 플랙은 이렇게 했습니다.g++ *.cpp -pedantic -Wall -S &lt;최적화-플랙&gt;-S&nbsp;플랙은 어셈블러 코드만 만들고 컴파일을 중지하라는 의미임..(어셈블리어를 봐야 제대로 마법을 부렸는지 확인할 수 있으니.... -_-)-O0-O0 플랙은 최적화를 하지말란 의미죠. 따라서 결과는 뻔한... 비졀스튜디오와 마찬가지로&nbsp;strlen()&nbsp;함수가 10으로 탈바꿈 해버렸단 게 좀 특이할 뿐.... 하지만 여전히 해쉬함수는 인라인 안되었습니다.LFE4: .def ___main; .scl 2; .type 32; .endef .section .rdata,"dr"LC0: .ascii "funny_bone\0"LC1: .ascii "hash value is 0x%8x\12\0" .text.globl _main .def _main; .scl 2; .type 32; .endef_main:LFB5: pushl %ebpLCFI4: movl %esp, %ebpLCFI5: andl $-16, %espLCFI6: subl $32, %espLCFI7: call ___main movl $10, 4(%esp) movl $LC0, (%esp) call __Z12generateHashPKcj movl %eax, 28(%esp) movl 28(%esp), %eax movl %eax, 4(%esp) movl $LC1, (%esp) call _printf movl $0, %eax leaveLCFI8: ret-O1이 플래그에서는 &nbsp;generateHash()&nbsp;함수가 인라인 됩니다만 여전히 계산은 다 합니다. 비졀 스튜디오랑 매우 비슷하군요?.def ___main; .scl 2; .type 32; .endef .section .rdata,"dr"LC0: .ascii "funny_bone\0"LC1: .ascii "hash value is 0x%8x\12\0" .text.globl _main .def _main; .scl 2; .type 32; .endef_main:LFB5: pushl %ebpLCFI0: movl %esp, %ebpLCFI1: andl $-16, %espLCFI2: pushl %ebxLCFI3: subl $28, %espLCFI4: call ___main movl $LC0, %eax movl $LC0+10, %ebx movl $0, %edxL2: imull $65599, %edx, %edx movsbl (%eax), %ecx addl %ecx, %edx addl $1, %eax cmpl %ebx, %eax jne L2 movl %edx, %eax shrl $16, %eax xorl %eax, %edx movl %edx, 4(%esp) movl $LC1, (%esp) call _printf movl $0, %eax addl $28, %esp popl %ebxLCFI5: movl %ebp, %espLCFI6: popl %ebpLCFI7: ret-O2-O1플래그와 결과가 같군요. (뭐 그도 그럴법한게 루프 언롤은 -O3 플래그에서나 활성회 돠거든요...) .def ___main; .scl 2; .type 32; .endef .section .rdata,"dr"LC0: .ascii "funny_bone\0"LC1: .ascii "hash value is 0x%8x\12\0" .text .p2align 4,,15.globl _main .def _main; .scl 2; .type 32; .endef_main:LFB5: pushl %ebpLCFI0: movl %esp, %ebpLCFI1: andl $-16, %espLCFI2: subl $16, %espLCFI3: call ___main movl $LC0, %eax xorl %edx, %edx .p2align 4,,7L2: imull $65599, %edx, %edx movsbl (%eax), %ecx addl $1, %eax addl %ecx, %edx cmpl $LC0+10, %eax jne L2 movl %edx, %eax shrl $16, %eax xorl %edx, %eax movl %eax, 4(%esp) movl $LC1, (%esp) call _printf xorl %eax, %eax leaveLCFI4: ret-O3드디어 결과가 나왔습니다! &nbsp;movl $-238617217, 4(%esp)&nbsp;보이시죠? 드디어 정수값 하나로 탈바꿈 했군요. .def ___main; .scl 2; .type 32; .endef .section .rdata,"dr"LC0: .ascii "hash value is 0x%8x\12\0" .text .p2align 4,,15.globl _main .def _main; .scl 2; .type 32; .endef_main:LFB5: pushl %ebpLCFI0: movl %esp, %ebpLCFI1: andl $-16, %espLCFI2: subl $16, %espLCFI3: call ___main movl $-238617217, 4(%esp) movl $LC0, (%esp) call _printf xorl %eax, %eax leaveLCFI4: retexe 파일을 열어서 문자열 검색을 해봐도 없었습니다. (스크린샷은 생략)-Os-Os&nbsp;는 크기를 제일 작게 최적화하란 플래그인데요. 역시 원하는 결과는 아닙니다.LFE4: .def ___main; .scl 2; .type 32; .endef .section .rdata,"dr"LC0: .ascii "funny_bone\0"LC1: .ascii "hash value is 0x%8x\12\0" .text.globl _main .def _main; .scl 2; .type 32; .endef_main:LFB5: pushl %ebpLCFI7: movl %esp, %ebpLCFI8: andl $-16, %espLCFI9: subl $16, %espLCFI10: call ___main movl $10, 4(%esp) movl $LC0, (%esp) call __Z12generateHashPKcj movl $LC1, (%esp) movl %eax, 4(%esp) call _printf xorl %eax, %eax leaveLCFI11: ret간단 정리자, 이 놀라운(어쩌면 어이없는 걸지도 -_-) 꼼수를 동작하게 하려면 필요한 비졀 스튜디오 2010과 g++의 최적화 플래그를 간단히 정리.Visual Studio 2010 SP1/O2/Ox (단 Enable String Pooling option을 킬 것)g++ 4.5.3-O3디버깅자, 그럼 코드에서 char* 문자열도 제거했으니 실행파일 용량도 작아질테고... 어랏? 근데 디버깅은 어쩌죠? 예를 들어서&nbsp;"0xF1C6FD7F"란 이름을 가진 본에서 크래쉬가 낫다면..... 이게 대체 3DS Max에서 어떤 본인지 어케 알까요? 디버깅을 하려면 char* 문자열이 여전히 필요하군요...... 써글 -_-;;;그렇다면 여태까지 한 걸 모두 접어야 할까요... 물론 그럴거면 이 글도 안썼겠죠 -_-; 이 데이터는 디버깅에만 유용한 거니까 디버깅에만 사용할 법한 꼼수를 찾아야죠. 생각해보면 사실 그닥 어려운 문제는 아닙니다. 그냥 문자열 데이터베이스 파일만 하나 있으면 되죠. 그 데이터베이스는 &lt;해쉬키, char*&gt;로 된 목록을 가질거고, 이제 1)게임코드에서 사용하는 모든 문자열과 2)툴에서 게임데이터로 저장하는 모든 문자열을 데이터베이스에 저장해 두기만 하면 됩니다.디버그 문자열 데이터베이스 만들기디버그 문자열 DB는 무슨 파일포맷으로 저장해야할까요? SQL DB 라이트도 나쁜 생각은 아니죠. 근데 전 그냥 &nbsp;텍스트 파일에 저장할 거 같습니다. 아무래도 SQL DB보다는 텍스트 파일이 게임엔진에서 쉽게 읽을 수 있을 거 같아서요. 뭐, 무슨 포맷을 선택하던 그냥 파일이름은&nbsp;debug.string_db로 하죠.도구에서 디버그문자열 DB 저장하기뭐, 도구에서 할 일은 크게 없습니다. 그냥 게임데이터 파일에&nbsp;새로운 문자열을&nbsp;저장할 때마다&nbsp;debug.string_db&nbsp;파일에도 저장하면 됩니다.끝 -_-. 룰루~게임코드에서 디버그 문자열 DB 저장하기그렇다면 코드 안에 있는 문자열은 어케 할까요. HASH_STRING() 매크로 안에 인자로 전해주는 문자열들이요. 뭐, 다행히 HASH_STRING()이란 매크로를 정의해뒀군요. 간단히 C#이나 파이썬 같은 스크립트 언어로 소스코드 디렉토리를 다 뒤지면서 HASH_STRING() 패턴이 보일때마다 그 안에 있는 char*를 해쉬값으로 변환해서&nbsp;debug.string_db에 저장하는 코드를 짜면 됩니다. regular expression을 쓰면 와따지요. 그리고 비졀 스튜디오 프로젝트의 포스트 빌드 이벤트로 이 스크립트를 한 번씩 호출해주면 끝... 속도도 꽤 빨라요... -_-뭐, 이건 아주 간단하진 않지만... 그닥 어렵지도 않은 문제였으니...... 끝.... -_- 룰루~문자열 값 찾기그럼 이제 비주얼 스튜디오에서 디버깅을 할 때&nbsp;디버그 문자열들을 찾는 문제만 남았는데.... (어차피 watch 창에는 int로 된 해쉬 값밖에 안보일테니까요.)문자역 룩업 툴DirectX SDK에 딸려오는 DirectX Error Lookup 툴 써보신 분 있으세요? 이따위로 생겼지요.간단히 이런 툴을 작성해도 됩니다. 툴이라고 해봤자 그냥&nbsp;debug.string_db&nbsp;파일을 읽어온 뒤 유저가 입력한 해쉬값과 일치하는 문자열을 찾아서 보여주는 게 전부죠. 일일이 해쉬값을 비졀 스튜디오 watch 창에서 복사해와 붙여넣는게 귀찮긴 하지만...... 쓰는데 큰 문제는 없겠죠?Visual Studio 플러그인?다음으로 해 본 생각은... 비주얼 스튜디오 플로그인을 만드는 겁니다. 제가 직접 비주얼 스튜디오 플러그인을 만들어 본 적이 없어서 이게 가능한지는 확실치 않은데...비주얼 스튜디오 플러그인에서 텍스트 파일이라던가 SQL DB를 읽어올 수 있다면... 그리고 watch 창 안에 디버그 데이터를 보여주는 방법을 맘대로 주무를 수 있다면 가능할 거 같은데요? 언젠가 시간이 남는다면 한 번 제작할지도 모르겠지만....일단 전 대충 문자열 룩업 툴로 만족 -_-디버그전용 해쉬문자열 매니저아니면 게임코드 안에 디버그전용 해쉬문자열 매니저를 만들어도 되죠. 디버그 빌드에서만debug.string_db&nbsp;파일을 로딩하게 만들면 되니까요. 그러면 코드 안에서 쉽게 문자열을 찾아낼 수 있죠. 이건 디버그 빌드에서만 동작하는 코드고 디스크 빌드에서는 컴파일러 스위치로 뿅~ 사라져야 하는 놈...좀 더 어이없는 생각 하나 더....디버그전용 해쉬문자열 문자열 매니저에 대해 쓰던 도중 갑자기 떠오른 생각.... 디버그전용 해쉬문자열 매니저가 로칼라이제이션 데이터베이스하고 되게 비슷한 거 같은데요? 문자열 ID를 키로 쓰고 거기에 대응하는 실제 문자열이 char* 값으로 들어가 있는 게 전부니... 나중에 언어를 바꿔주고 싶으면 그냥 각 문자열 ID마다 다른 언어로 char* 값이 들어가있는 로칼라이제이션 DB 파일을 로딩해버리면 되니까.... 해쉬문자열 매니저와 매우 비슷....따라서 디버그전용 해쉬문자열을 구현하기로 결정을 했다면 동일한 아키텍처를 이용해서 로칼라이제이션을 해버리면 어떨까 하는 생각... 사실 로칼라이제이션 DB에 대해서는 아는게 별로 없으므로 허무맹랑한 소리일지도 모릅니다. 그냥 이딴 생각이 들었을뿐입니다.... -_-아악! 좀 커다란 문제가 하나....위에 글을 쓰고 매우 기뻐하고 있었는데... 제 동료인 Noel 아저씨가 갑자기 이딴 질문을.... "그 루프 언롤은 문자열의 길이에 상관없이 잘 돌아? 졸 길면 안되지 않을까?"... 그래서 다시 한번 재빨리 테스트를 해보니....... 흙~Visual Studio 2010 SP1Visual Studio 2010 SP1 는 10글자까지만 제대로 동작하더군요. -_-&nbsp; "funny_bone1"이라고 11글자를 넣으니 이따위 결과가...!_main PROC      ; COMDAT; File e:\temp\x65599\main.cpp; Line 12 xor ecx, ecx xor eax, eax npad 12$LL5@main: movsx edx, BYTE PTR $SG-5[eax] imul ecx, 65599    ; 0001003fH inc eax add ecx, edx cmp eax, 11     ; 0000000bH jb SHORT $LL5@main mov eax, ecx shr eax, 16     ; 00000010H xor eax, ecx; Line 13 push eax push OFFSET $SG-6 call DWORD PTR __imp__printf add esp, 8; Line 15 xor eax, eax; Line 16 ret 0_main ENDPg++g++은 좀 납디다.. 아니 많이...&nbsp;g++은 무려 17글자까지! 두둥!&nbsp;"funny_bone12345678"이라고 17글자를 넣으니 그제서야 이런 결과가.... .def _main; .scl 2; .type 32; .endef_main:LFB5: pushl %ebpLCFI0: movl %esp, %ebpLCFI1: andl $-16, %espLCFI2: subl $16, %espLCFI3: call ___main movl $LC0, %eax xorl %edx, %edx .p2align 4,,7L2: imull $65599, %edx, %edx movsbl (%eax), %ecx addl $1, %eax addl %ecx, %edx cmpl $LC0+18, %eax jne L2 movl %edx, %eax shrl $16, %eax xorl %edx, %eax movl %eax, 4(%esp) movl $LC1, (%esp) call _printf xorl %eax, %eax leaveLCFI4: ret그래서, 뭐 어쩌라고?위의 실험이 의미하는 바는.... 컴파일러 따라 10이나 17자 까지만 멋지게 최적화가 된다는 거지요. 다른 문자열들은 실행도중에 계산됩니다... 으음... 그래도 과연 이런 짓(?)을 할 가치가 있을까 생각을 해봤는데요. 그래도 가치는 있다고 생각합니다.&nbsp;가장 큰 이유는 최소한 게임데이터 파일 안에서 문자열이 사라지니까요.&nbsp;대신 다음과 같은 가이드라인을 좀 따라야겠죠.가능한 룩업키로 사용하는 문자열의 길이를 짧게 만든다.동일한 문자열에 HASH_STRING() 매크로를 여러 번 호출하지 않는다. 대신 계산은 한 번만 하고 그 값을 다른 데 저장해뒀다 필요할 때마다 불러와 사용한다. (예. 오브젝트의 멤버변수로 저장)또 미래의 컴파일러가 루프 언롤을 좀 더 잘 해줄 수도 있구요. 한 64 글자까지만 되면 좋을텐데 말이죠.... &nbsp;(비졀 스튜디오&nbsp;2011 Preview에서도 여전히 10글자더군요)아니면 C+11의&nbsp;constexpr를 여따 쓸 수 있을까요..... 하지만 비졀스튜디오 2011 프리뷰에서도 아직 이 놈을 지원 안하는 걸요?...... 그러니 별 소용이 -_-제가 가장 선호하는 해결책은 MS사에서 다음과 같은 컴파일러 스위치를 추가해주는 겁니다.inline unsigned int generateHash(const char *string, size_t len){&nbsp; unsigned int hash = 0;&nbsp; #pragma unroll&nbsp; for(size_t i = 0; i &lt; len; ++i)&nbsp; {&nbsp; &nbsp; hash = 65599 * hash + string[i];&nbsp; }&nbsp; return hash ^ (hash &gt;&gt; 16);}이러면 len의 길이가 컴파일시에 이미 정해져 있는 경우 컴파일러가 루프 전체를 언롤해주는거죠. IBM 컴파일러에 저거랑 비슷한 컴파일러 스위치가 있다고 들었고, HLSL 컴파일러는 이미 저걸 지원하니 C++ 컴파일러에 저걸 넣지 못할 이유가 없을 듯 한데 말이죠.마소 아저씨들! 저 컴파일러 옵션좀 추가해 주세요!급한대로 땜빵 해법영문 블로그에 며칠전에 이 글을 올렸었는데 그 뒤에&nbsp;Mikkel Gjoel&nbsp;아찌가 트위터에서 말해주기를 Humus 아찌가&nbsp;이 글자 제한에 상관없이 컴파일시에 해쉬를 만들어 내는 법을 알고 있다고 귀뜸 해줬습니다.그래서 냅따 시도해봤지요. 오오~ 잘 작동합니다. 64글자까지 실험해봤는데 다 되요! 프로그래머가 사용하기 좀 불편하다는 단점은 있는데요. 범용적인&nbsp;generateHash(const char*) 함수를 특화된&nbsp;generateHash(const char &amp;(string)[N]); 함수들과 동시에 선언해둘수가 없거든요. 컴파일러가 헷갈려해요 -_-영문 블로그에 커멘트로 달린&nbsp;AltDevBlogADay 링크에서 바로 위에 지워버린 내용을 해결할 수 있는 방법을 발견했습니다.struct ConstCharWrapper{&nbsp; &nbsp; inline ConstCharWrapper(const char* str) : m_str(str) {}&nbsp; &nbsp; const char* m_str;};inline unsigned int generateHash(ConstCharWrapper wrapper, size_t len){&nbsp; &nbsp; const char* string = wrapper.m_str;&nbsp; &nbsp; // 요밑은 이전과 똑같은 코드}그리고 비졀 스튜디오 2010이 좀 멍청해서... 다음의 두 코드가 같은 놈이란 걸 모르고.. 첫번째 놈을 해쉬값으로 바꿔주는 데 실패하더군요. 물론 제 해쉬 함수를 쓸때도요... (g++은 잘 함...)#1const char * const funny = "funny_bone";unsigned int hashValue = HASH_STRING(funny);#2unsigned int hashValue = HASH_STRING("funny_bone");그러나 #1 방식을 쓰면 디버그 스트링 DB를 만들려고 regular expression을 쓸 때도 개판이 나니... 첫번째 방법을 쓰면 안되겠죠. 그럼 상수 문자열을 쓸 때 다른 프로그래머들이 첫번째 방법을 쓰지 않도록 강제 교육할 방법이 있어야 할텐데..... 일단 좀더 생각해봐야 겠어요.어쨌든 이 새로운 정보를 좀 덜 짜증나게 쓸 수 있는 방법을 찾아내면 새로운 글을 올리지요. 이미... 너무 길어요.. 글이... 흙~ -_-</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-11
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/cpp/">C++</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li><li class="row mb-2">
            <div class="col-lg-8 offset-lg-2 py-3 px-md-5">
                <article>
                    <a class="article-link-box" href="/ko/2012/01/09/intro-to-shader-04-lighting-part-3.html">
                        <section>
                            <h3>
                                [포프의 쉐이더 입문강좌] 04. 기초적인 조명쉐이더 Part 3
                            </h3>
                            <img class="center-crop" src="/ko/assets/img/2012/01/20.jpg"/>
                            
                            <p>이전편 보기정 반사광배경정 반사광(specular light)(이것을 반사광이라 부르기도 합니다.)은 난 반사광과는 달리 한 방향으로만 반사되는 빛으로 입사각이 출사각과 같은 것이 특징입니다. 따라서 정 반사광의 효과를 보려면 빛이 반사되는 방향에서 물체를 바라봐야만 합니다. 모니터에 빛이 반사 되서 화면을 보기 힘들었던 기억 있으시죠? 그 때 모니터를 조금 돌리면 조금 살만했던 거도요? 그게 바로 정 반사광입니다.앞에서 보여 드렸던 난 반사광을 그림에 정 반사광도 추가해 보지요.그림 4.8 난 반사광과 정 반사광난 반사광과 마찬가지로 정 반사광을 수학적으로 재현해내는 수학공식이 여럿 있습니다. 여기서는 게임업계에서 널리 사용하는 기법인 퐁(phong) 모델을 사용하겠습니다. 퐁 모델은 반사광과 카메라벡터(카메라에서 현재 위치까지 선을 그은 벡터)가 이루는 각도의 코사인 값을 구하고, 그 결과를 여러번 거듭제곱하면 정 반사광을 구할 수 있다고 합니다. 아래의 그림을 보시죠.그림 4.9. 정반사광의 예반사광(R)과 카메라벡터(V)가 이루는 각도의 코사인 값을 구하는 것은 난 반사광에서 했던 것과 별반 차이가 없겠군요. 법선벡터와 입사광 벡터 대신에 반사광 벡터와 카메라벡터를 쓰는 것만 빼면요. 근데 왜 이 결과에 다시 거듭제곱을 할까요? 역시 코사인 그래프를 보면 답이 보입니다.그림 4.10. 거듭제곱수가 늘어남에 따라 빠르게 줄어드는 코사인 그래프위 그래프에서 보면 거듭제곱수가 늘어남에 따라 코사인 값이 빠르게 줄어드는 거 보이시죠? 실생활에서 정 반사광을 관찰해봅시다. 정반사광의 폭이 얼마나 되나요? 난 반사광에 비해 상당히 타이트하지 않나요? 바로 이런 타이트한 정 반사광을 재현하기 위해 코사인 값에 거듭제곱을 하는 겁니다.그러면 거듭제곱은 몇 번이나 해야 할까요? 이건 사실 표면의 재질에 따라 다릅니다. 거친 표면일수록 정 반사광이 덜 타이트할 테니까 거듭제곱 수를 줄여줘야겠죠. 보통 한 20번 정도 거듭제곱을 해주면 대충 괜찮은 결과를 얻으실 수 있습니다.그럼 이제 쉐이더를 작성해 봅시다.기초설정바로 조금 전에 작성했었던 난 반사광 쉐이더에 정 반사광 조명 코드를 추가하도록 하죠. 어차피 이 두 광이 합쳐져야 제대로 된 조명효과니까요.그림 4.9에서 새로 추가된 것이 뭐가 있었죠? 반사광 벡터하고 카메라 벡터죠? 반사광 벡터야 입사광 벡터를 법선에 대해 반사시킨 것이니(입사각과 출사각이 같습니다) 이미 가지고 있는 정보에서 구할 수 있겠네요. 카메라 벡터는요? 입사광의 벡터를 구했던 것과 마찬가지 방법으로 카메라 위치에서 현재 위치까지 선을 쭈욱~ 그으면 되겠죠? 그러려면 카메라 위치를 전역변수로 만들어야 겠네요. 렌더몽키의 Lighting 쉐이더 위에 마우스 오른쪽 버턴을 눌러 새로운 float4 변수를 추가합시다. 이름은 gWorldCameraPosition이 적당하겠네요. 이제 이 변수 위에 마우스 오른쪽 버튼을 눌러 ViewPosition이라는 변수 시맨틱을 대입합니다.이 외에 별다른 설정은 없는 것 같군요. 이제 정점쉐이더를 살펴봅시다.정점쉐이더마찬가지로 정점쉐이더의 전체 소스코드부터 보여드리겠습니다.float4x4 gWorldMatrix;float4x4 gViewMatrix;float4x4 gProjectionMatrix;float4 gWorldLightPosition;float4 gWorldCameraPosition;struct VS_INPUT{&nbsp; &nbsp;float4 mPosition : POSITION;&nbsp; &nbsp;float3 mNormal: NORMAL;};struct VS_OUTPUT{&nbsp; &nbsp;float4 mPosition : POSITION;&nbsp; &nbsp;float3 mDiffuse : TEXCOORD1;&nbsp; &nbsp;float3 mViewDir: TEXCOORD2;&nbsp; &nbsp;float3 mReflection: TEXCOORD3;};VS_OUTPUT vs_main( VS_INPUT Input ){&nbsp; &nbsp;VS_OUTPUT Output;&nbsp; &nbsp;Output.mPosition = mul( Input.mPosition, gWorldMatrix );&nbsp; &nbsp;float3 lightDir = Output.mPosition.xyz - gWorldLightPosition.xyz;&nbsp; &nbsp;lightDir = normalize(lightDir);&nbsp; &nbsp;float3 viewDir = normalize(Output.mPosition.xyz - gWorldCameraPosition.xyz);&nbsp; &nbsp;Output.mViewDir = viewDir;&nbsp; &nbsp;Output.mPosition = mul( Output.mPosition, gViewMatrix );&nbsp; &nbsp;Output.mPosition = mul( Output.mPosition, gProjectionMatrix );&nbsp; &nbsp;float3 worldNormal = mul( Input.mNormal, (float3x3)gWorldMatrix );&nbsp; &nbsp;worldNormal = normalize(worldNormal);&nbsp; &nbsp;Output.mDiffuse = dot(-lightDir, worldNormal);&nbsp; &nbsp;Output.mReflection = reflect(lightDir, worldNormal);&nbsp; &nbsp;return Output;}정점쉐이더 입력데이터 및 전역변수일단 정점쉐이더 입력데이터를 보죠. 새로 필요한 정점정보가 있나요? 아무리 생각해도 별 다른 게 안 떠오르는 거 보니 없는 거 같네요. 난 반사광에 사용했던 입력구조체를 그냥 사용해도 될 거 같습니다.그렇다면 전역변수는 어떻죠? 방금 전에 추가했던&nbsp;gWorldCameraPosition을 선언해야겠죠? 다음의 코드를 추가합니다.float4 gWorldCameraPosition;정점쉐이더 출력데이터이제 정점쉐이더 출력데이터를 살펴보도록 하죠. 난 반사광에서 그랬던 것처럼 정점쉐이더에서 정 반사광을 계산한 뒤에 픽셀쉐이더에 전달해 주면 될까요? 불행히도 그렇진 않습니다. 정 반사광을 구하려면 코사인 값에 거듭제곱을 해야 하는데 거듭제곱을 한 뒤 보간(interpolate)을 한 결과와 보간을 한 뒤에 거듭제곱을 한 결과의 차이는 엄청납니다. 따라서 정 반사광 계산은 픽셀 쉐이더에서 해야 하니 이 계산에 필요한 두 방향벡터인 R과 &nbsp;V를 구한 뒤에 픽셀쉐이더에 전달해 주도록 하겠습니다. 다음의 코드를 VS_OUTPUT에 추가합시다.&nbsp; &nbsp;float3 mViewDir: TEXCOORD2;&nbsp; &nbsp;float3 mReflection: TEXCOORD3;정점쉐이더 함수이제 정 반사광을 계산하는데 필요한 두 방향벡터를 구해보죠. 카메라 벡터는 어떻게 구한다고 했었죠? 그냥 카메라 위치로부터 현재위치까지 선을 그으면 된다고 했죠? 입사광의 방향벡터를 구하는 것과 별 다를 바가 없겠네요. 입사광의 방향벡터를 구하는 코드 바로 아래에 다음의 코드를 추가합니다.&nbsp; &nbsp;float3 viewDir = normalize(Output.mPosition.xyz - gWorldCameraPosition.xyz);&nbsp; &nbsp;Output.mViewDir = viewDir;이제 정 반사광의 방향벡터를 구할 차례입니다. 이 때, 빛의 입사각과 출사각이 같다고 말씀드렸었죠? 그럼 반사벡터를 구하는 수학 공식이 필요하겠군요. 근데 이런 공식은 굳이 기억하지 않으셔도 됩니다. (저도 수학책 다시 열어봐야 압니다. -_-) 여태까지 그랬던 것처럼 당연히 이런 것을 척척 처리해주는 HLSL 함수가 있겠죠? reflect()라는 함수입니다. reflect는 첫 번째 인자로 입사광의 방향벡터를 두 번째 인자로 반사 면의 법선을 받습니다. Output을 반환하기 바로 전에 다음의 코드를 입력합니다.&nbsp; &nbsp;Output.mReflection = reflect(lightDir, worldNormal);자, 이제 두 벡터를 다 구해봤으니 정점쉐이더에서 할 일은 끝났습니다.픽셀쉐이더마찬가지로 픽셀쉐이더의 전체 코드부터 보여드립니다.struct PS_INPUT{&nbsp; &nbsp;float3 mDiffuse : TEXCOORD1;&nbsp; &nbsp;float3 mViewDir: TEXCOORD2;&nbsp; &nbsp;float3 mReflection: TEXCOORD3;};float4 ps_main(PS_INPUT Input) : COLOR{&nbsp; &nbsp;float3 diffuse = saturate(Input.mDiffuse);&nbsp; &nbsp;float3 reflection = normalize(Input.mReflection);&nbsp; &nbsp;float3 viewDir = normalize(Input.mViewDir);&nbsp; &nbsp;float3 specular = 0;&nbsp; &nbsp;if ( diffuse.x &gt; 0 )&nbsp; &nbsp;{&nbsp; &nbsp; &nbsp; specular = saturate(dot(reflection, -viewDir ));&nbsp; &nbsp; &nbsp; specular = pow(specular, 20.0f);&nbsp; &nbsp;}&nbsp; &nbsp;float3 ambient = float3(0.1f, 0.1f, 0.1f);&nbsp; &nbsp;return float4(ambient + diffuse + specular, 1);}우선 정점쉐이더 출력데이터에서 가져올 두 벡터를 PS_INPUT 구조체에 추가합니다.&nbsp; &nbsp;float3 mViewDir: TEXCOORD2;&nbsp; &nbsp;float3 mReflection: TEXCOORD3;이전에 diffuse를 구했던 코드 바로 밑에 새로운 코드들을 추가하겠습니다. 우선 mReflection과 mViewDir을 다시 한번 정규화시켜 줍니다. 정점쉐이더에서 이미 단위벡터로 만들었던 이 벡터들을 다시 정규화해 주는 이유는 보간기를 거치는 동안 그 값이 흐트러질 수 있기 때문입니다.&nbsp;(보간기가 선형적(linear)으로 보간을 해서 그렇습니다.)&nbsp; &nbsp;float3 reflection = normalize(Input.mReflection);&nbsp; &nbsp;float3 viewDir = normalize(Input.mViewDir);이제 이 두 벡터의 내적을 구한 뒤, 거듭제곱을 합니다.&nbsp; &nbsp;float3 specular = 0;&nbsp; &nbsp;if ( diffuse.x &gt; 0 )&nbsp; &nbsp;{&nbsp; &nbsp; &nbsp; specular = saturate(dot(reflection, -viewDir ));&nbsp; &nbsp; &nbsp; specular = pow(specular, 20.0f);&nbsp; &nbsp;}위에서 난반사광의 양이 0% 이상일 때에만 정 반사광을 계산하는 거 보이시죠? 난 반사광이 존재하지 않는 표면에는 이미 빛이 닿지 않으므로 정 반사광이 존재할 수가 없기 때문입니다. 내적을 구할 때 -viewDir을 사용한 것도 보이시죠? 난 반사광을 구할 때와 마찬가지로 두 벡터의 밑동이 만나야 올바른 내적의 결과를 구할 수 있기 때문입니다.또한 거듭제곱을 할 때 pow() 함수를 이용한 것도 눈 여겨 봐주시기 바랍니다. 여기서는 20번 거듭제곱을 했는데 각 물체마다 이 값을 다르게 하는 것이 보통입니다.&nbsp;(거듭제곱의 수가 높을 수록 정반사광의 범위가 타이트해집니다. 숫자를 바꿔보면서 실험해보세요.)&nbsp;&nbsp;따라서 이 값을 float형의 전역변수로 선언해주는 게 보다 나은 방법이 되겠습니다. 이 정도는 독자 분들의 몫으로 남겨두도록 하지요.이제 결과를 반환할 차례입니다. 일단 정 반사광의 효과만을 보기 위해 specular만을 반환해볼까요? 이전에 있던 return문을 다음과 같이 바꿉니다.&nbsp; return float4(specular, 1);이제 쉐이더를 컴파일한 뒤 실행해보면 다음의 결과를 보실 수 있을 것입니다.그림 4.11. 난 반사광에 비해 매우 강렬하고 타이트한 하이라이트를 보여주는 정 반사광이제 정 반사광이 어떤 건지 확실히 보이시죠? 여기에 난 반사광을 더하면 보다 완벽한 조명효과가 되겠네요. return 코드를 다음과 같이 바꿔봅시다.&nbsp; &nbsp; return float4(diffuse + specular, 1);위 코드에서 난 반사광과 정 반사광을 더하면 그 결과가 1이 넘는 경우가 있는데 크게 걱정하지 않으셔도 됩니다. 그런 경우엔 알아서 1이 됩니다.&nbsp;(현재 하드웨어 백버퍼의 포맷이 8비트 이미지이기 때문입니다. 부동소수점 텍스처를 사용하면 1 이상의 값을 저장할 수도 있습니다.)이제 정점쉐이더와 픽셀쉐이더를 각각 컴파일 하신 뒤 미리 보기 창을 보면 다음과 같은 결과가 보이죠?그림 4.12. 난 반사광 + 정 반사광자, 이 정도면 훌륭한 조명효과입니다. 하지만 공의 왼쪽 밑부분이 칠흑같이 어두운 게 좀 망에 안 드는군요. 앞서 말씀 드렸다시피 실제세계에서는 간접광이 저 어두운 부분을 비춰줄 텐데 말이지요. 그럼 아주 간단하게 주변광을 정의해줘서 저 부분을 조금이나마 밝혀볼까요? 주변광을 10%로 선언해서 ambient 변수에 대입해주도록 합시다.&nbsp; &nbsp; float3 ambient = float3(0.1f, 0.1f, 0.1f);그리고 최종 반환 값에 ambient를 추가합니다.&nbsp; &nbsp;return float4(ambient + diffuse + specular, 1);이제 결과가 아래와 같이 바뀔 겁니다.그림 4.13. 주변광 + 난 반사광 + 정 반사광선택사항: DirectX 프레임워크이제 C++로 작성한 DirectX 프레임워크에서 쉐이더를 사용하시고자 하는 분들을 위한 선택적인 절입니다.우선 '제3장: 텍스처매핑'에서 사용했던 프레임워크의 사본을 만들어 새로운 폴더에 저장합니다. 그 다음, 렌더몽키에서 사용했던 쉐이더와 3D 모델을 DirectX 프레임워크에서 사용할 수 있도록 파일로 저장합니다. Sphere.x와 Lighting.fx라는 파일이름을 사용하도록 하겠습니다.이제 비주얼 C++에서 솔루션 파일을 엽니다.자, 그럼 전역변수를 먼저 살펴보겠습니다. 일단 이 장에서는 텍스처를 사용하지 않으니 저번 장에서 선언했던 텍스처 변수, gpEarthDM를 지우겠습니다. 그 다음, 쉐이더 변수의 이름을 gpTextureMappingShader에서 gpLightingShader로 바꿉니다.이제 새로운 변수들을 선언할 차례입니다. 광원의 위치와 카메라의 위치가 필요했었죠? 이 둘은 모두 월드공간 안에 있었네요. 렌더몽키에서 사용했던 빛의 위치를 다시 사용하겠습니다.// 빛의 위치D3DXVECTOR4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gWorldLightPosition(500.0f, 500.0f, -500.0f, 1.0f);카메라 위치는 예전에 RenderScene() 함수 안에서 사용했던 값을 그대로 가져왔습니다.// 카메라 위치D3DXVECTOR4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gWorldCameraPosition( 0.0f, 0.0f, -200.0f, 1.0f );이제 CleanUp() 함수로 가봅시다. 더 이상 gpEarthDM 텍스처를 사용하지 않으니 이를 해제하는 코드를 지웁니다.다음은 LoadAssets() 함수 입니다. 우선 gpEarthDM 텍스처를 로딩하는 코드를 삭제합니다. 그리고 쉐이더의 파일명을 Lighting.fx로 바꿉니다. gpTextureMappingShader라는 변수명을gpLightingShader로 바꾸는 것도 잊지 마세요.&nbsp; &nbsp; // 텍스처 로딩&nbsp; &nbsp; // 쉐이더 로딩&nbsp; &nbsp; gpLightingShader = LoadShader("Lighting.fx");&nbsp; &nbsp; if ( !gpLightingShader )&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; return false;&nbsp; &nbsp; }마지막으로 RenderScene() 함수를 보겠습니다. 일단gpTextureMappingShader 라는 변수명을 모두 찾아gpLightingShader로 바꿉니다. 이제 뷰행렬을 만드는 코드를 보죠. 뷰행렬을 만들 때 사용했던 vEyePt라는 변수가 있었죠? 이 변수의 값이 앞서 정의했던 gWorldCameraPosition의 값과 동일하니 gWolrldCameraPosition의 값을 사용하도록 하지요.예전에 아래처럼 되어 있던 코드를&nbsp; &nbsp; D3DXVECTOR3 vEyePt( 0.0f, 0.0f, -200.0f );다음과 같이 바꿉니다.&nbsp; &nbsp; D3DXVECTOR3 vEyePt( gWorldCameraPosition.x, gWorldCameraPosition.y,&nbsp; &nbsp; &nbsp; &nbsp; gWorldCameraPosition.z );이제gpLightingShader-&gt;SetTexture() 코드를 지웁니다. 이 장에서 만든 쉐이더에는 텍스처를 사용하지 않으니 이 코드가 필요 없습니다. 그럼 마지막으로 광원의 위치와 카메라의 위치를 쉐이더에 전달해 줍니다. 이들의 데이터형은 D3DXVECTOR4이므로 쉐이더에서 SetVector()를 호출합니다.&nbsp; &nbsp; gpLightingShader-&gt;SetVector("gWorldLightPosition", &amp;gWorldLightPosition);&nbsp; &nbsp; gpLightingShader-&gt;SetVector("gWorldCameraPosition", &amp;gWorldCameraPosition);이제 코드를 컴파일 한 뒤 실행해보시죠. 아까 렌더몽키에서 보셨던 것과 동일한 결과를 볼 수 있죠?기타 조명기법여전히 대부분의 게임이 사용하는 조명기법은 람베르트 + 퐁이지만 최근 들어 다른 조명기법들을 사용하는 게임들이 늘어나고 있습니다. 조명기법을 좀 더 심층적으로 연구하고 싶으신 독자 분들을 위해 몇 가지 기법을 언급하겠습니다.블린-퐁(Blinn-Phong): 퐁과 거의 비슷한 기법. 현재도 많이 사용함오렌-네이어(Oren-Nayar): 표면의 거친 정도를 고려한 난 반사광 조명기법쿡-토런스(Cook-Torrance): 표면의 거친 정도를 고려한 정 반사광 조명기법구면조화 조명기법(spherical harmonics lighting): 오프라인에서 간접광을 사전 처리한 뒤, 실시간에서 이를 주변광으로 적용할 때 사용할 수 있음정리다음은 이 장에서 배운 내용을 짧게 요약해 놓은 것입니다.람베르트 모델은 난 반사광을 계산하는 기법으로 코사인 함수를 사용한다.퐁 모델은 정 반사광을 계산하는 기법으로 코사인 값을 거듭제곱 한다.벡터의 길이를 1로 바꾸면 내적을 구하는 것만으로도 코사인 함수를 대신할 수 있다.동일한 계산을 어느 쪽에서도 할 수 있다면 픽셀쉐이더 보다는 정점쉐이더에서 한다.이 장에서 배운 조명보다 훨씬 사실적이고 복잡한 기법들이 존재한다. 그 중 일부는 이미 몇몇 게임에서 쓰이고 있다.이제 조명기법까지 마쳤으니 쉐이더의 기초는 다 배운 거나 다름없습니다. 다음 장부터는 여태까지 배웠던 지식들을 잘 혼합하여 보다 실용적인 기법들을 구현해 보겠습니다. 제1~4장 중에 잘 이해가 안 되는 내용이 있었다면 다시 한 번 복습을 하신 뒤에 제5장으로 넘어오시기 바랍니다.다음편 보기</p><footer class=""><img width="40" src="/ko/assets/img/authors/pope.gif" class="rounded-circle" /><small class="border border-dark border-left-0 border-top-0 border-bottom-0 pr-2 pr-lg-2 align-middle font-weight-bold pl-2">김포프</small><small class=" pl-1 pl-lg-2 align-middle">
                                    <i class="far fa-calendar-alt mr-2 opacity-75"></i>
                                    2012-01-09
                                </small>
                            </footer>
                        </section>
                    </a>
                    
                    <footer class="pt-1 pb-4 border border-right-0 border-top-0 border-left-0">
                        <ul class="list-inline list-unstyled">
                            <li class="list-inline-item align-middle opacity-75">
                                <small><i class="fas fa-tags"></i></small>
                            </li>
                        
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/book/">도서</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader-book/">셰이더강좌</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/graphics/">그래픽</a></small>
                            </li>
                            
                             
                            
                            <li class="list-inline-item align-middle">
                                <small><a class="tag-link" href="/ko/tags/shader/">shader</a></small>
                            </li></ul>
                    </footer></article>
            </div>
        </li>
        
<nav class="py-2">
    <ul class="pagination justify-content-center">
        <li
            class="page-item">
            <a class="page-link"
                href="/ko/categories/dev/page/9/">이전</a>
        </li><li class="page-item"><a class="page-link" href="/ko/categories/dev/page/5">...</a></li><li class="page-item"><a class="page-link"
                href="/ko/categories/dev/page/6/">6</a>
        </li><li class="page-item"><a class="page-link"
                href="/ko/categories/dev/page/7/">7</a>
        </li><li class="page-item"><a class="page-link"
                href="/ko/categories/dev/page/8/">8</a>
        </li><li class="page-item"><a class="page-link"
                href="/ko/categories/dev/page/9/">9</a>
        </li><li class="page-item disabled"><a class="page-link"
                href="/ko/categories/dev/page/10/">10</a>
        </li><li class="page-item"><a class="page-link" href="/ko/categories/dev/page/11">...</a></li><li class="page-item">
            <a class="page-link"
                href="/ko/categories/dev/page/11/">다음</a>
        </li>
    </ul>
</nav>
        
    </ul></div>
    </div>
    
    <footer class="site-footer position-absolute border-top">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-5 pl-sm-0 pl-lg-6">
                <div>
                    <span class="ml-1">Copyright © 2010 - 2025. Pope Kim</span>
                </div>
            </div>
            <div class="col col-md-5 m-0 p-sm-0 text-md-right">
                <a class="mr-sm-3 mr-0 text-secondary text-nowrap font-weight-bold" href="/en">English</a>
                <span class="h5 opacity-75"><a href="/ko/feed.xml" class="badge badge-dark"><i class="fas fa-rss"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.youtube.com/c/PopeTV/" class="badge badge-dark" target="_blank"><i class="fab fa-youtube"></i></a></span>
                <span class="h5 opacity-75"><a href="https://x.com/blindrendererkr" class="badge badge-dark" target="_blank"><i class="fab fa-twitter"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.linkedin.com/in/popekim/" class="badge badge-dark" target="_blank"><i class="fab fa-linkedin-in"></i></a></span>
                <span class="h5 opacity-75"><a href="https://www.github.com/popekim/" class="badge badge-dark" target="_blank"><i class="fab fa-github"></i></a></span>
            </div>
        </div>
    </div>
</footer>
    
<script src="/ko/assets/lib/jquery/jquery-3.7.1.slim.min.js"></script>
<script src="/ko/assets/lib/bootstrap/js/bootstrap.bundle.js"></script>
<script src="/ko/assets/lib/prism/js/prism.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-asm6502.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-c.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-cpp.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-csharp.min.js"></script>
<script src="/ko/assets/lib/prism/js/prism-java.min.js"></script>
<script src="/ko/assets/js/prism/prism-masm.min.js"></script>
<script src="/ko/assets/js/saveLangToCookie.js" type="text/javascript"></script>

</body>

</html>